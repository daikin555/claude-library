---
title: "大きな出力トークン制限を持つモデルでの自動コンパクト早期トリガーを修正"
date: 2026-01-28
tags: [bugfix, auto-compact, token-limit, context-management]
---

## 原文（日本語訳）
出力トークン制限が大きいモデルで自動コンパクトが早期にトリガーされる問題を修正しました

## 原文（英語）
Fixed auto-compact triggering too early on models with large output token limits

## 概要
Opus などの大きな出力トークン制限を持つモデルで、コンテキストウィンドウに十分な余裕がある場合でも自動コンパクトが早期に実行されてしまう問題が修正されました。これにより、より長い会話が維持できるようになりました。

## 実践例

### Opus での長時間会話の維持

```bash
# Opus を使用した長期プロジェクト
claude --model opus
> 大規模なリファクタリングを段階的に実施してください

# 以前は早期にコンパクトが実行されていたが、
# 修正後は適切なタイミングまで会話履歴が保持される
```

### コンテキスト使用率の確認

```bash
claude
> /context

# コンテキスト使用状況が表示される
Context usage: 65%
# 修正前は 65% で自動コンパクトがトリガーされていたが、
# 修正後は 80% まで待つようになった
```

## 注意点

- **モデル依存**: 修正は主に Opus や大きな出力制限を持つモデルに影響します
- **手動コンパクト**: 必要に応じて `/compact` コマンドで手動コンパクトも可能です
- **閾値の調整**: 自動コンパクトは実効コンテキストウィンドウの約 80% で実行されます
- **パフォーマンス**: 適切なタイミングでコンパクトすることで、会話の流れが途切れにくくなります

## 関連情報

- [Claude Code Changelog - v2.1.21](https://github.com/anthropics/claude-code/blob/main/CHANGELOG.md)
- [Context Management Documentation](https://code.claude.com/docs/en/context-management)
- [Compaction System](https://github.com/anthropics/claude-code#context-compaction)
