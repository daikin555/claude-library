---
title: "ストリーミングAPIでのtemperatureOverride無視問題の修正"
date: 2026-02-04
tags: [api, streaming, temperature, fix]
---

# ストリーミングAPIでのtemperatureOverride無視問題の修正

## 原文（日本語に翻訳）
ストリーミングAPIパスでtemperatureOverrideが無視される問題を修正し、設定されたオーバーライドに関係なく、すべてのストリーミングリクエストがデフォルトのtemperature（1）を使用していた問題を解消しました。

## 原文（英語）
Fixed `temperatureOverride` being silently ignored in the streaming API path, causing all streaming requests to use the default temperature (1) regardless of the configured override

## 概要
Claude Codeのストリーミング応答において、ユーザーが設定したtemperatureOverrideが適用されず、常にデフォルト値（1.0）が使用されていた問題が修正されました。この修正により、カスタムtemperature設定が正しくストリーミングAPIリクエストに反映されるようになりました。

## 基本的な使い方

### temperatureOverride の設定
`~/.claude/settings.json` でtemperatureを設定：

```json
{
  "temperatureOverride": 0.7
}
```

### 設定の確認
```bash
# 設定ファイルを確認
cat ~/.claude/settings.json | grep temperature

# Claude Codeを起動
claude

# ストリーミング応答でカスタムtemperatureが適用される
> "創造的なアイデアを10個挙げて"

# temperatureOverride: 0.7 が正しく適用される
```

## 実践例

### 決定論的な応答が必要な場合（temperature: 0）
コード生成やデータ処理など、一貫性が重要なタスクに最適：

```json
{
  "temperatureOverride": 0
}
```

```bash
claude

> "このPython関数をTypeScriptに変換して"
> "JSONスキーマを生成して"

# 以前: temperature=1で毎回異なる結果
# 現在: temperature=0で一貫した結果
```

### バランスの取れた応答（temperature: 0.7）
一般的なタスクに推奨される設定：

```json
{
  "temperatureOverride": 0.7
}
```

```bash
claude

> "この機能の実装方法を提案して"
> "コードレビューをして"

# 創造性と一貫性のバランスが取れた応答
```

### 創造的な応答が必要な場合（temperature: 1.0）
ブレインストーミングやアイデア生成に最適：

```json
{
  "temperatureOverride": 1.0
}
```

```bash
claude

> "新しい機能のアイデアを提案して"
> "このUIデザインに対する代替案を考えて"

# 多様で創造的な提案が得られる
```

### タスクごとに設定を変更
プロジェクトごとに異なる設定を使用：

```bash
# プロジェクトA: コード生成タスク
cd ~/project-a
echo '{"temperatureOverride": 0}' > .claude/settings.json

# プロジェクトB: クリエイティブタスク
cd ~/project-b
echo '{"temperatureOverride": 1.0}' > .claude/settings.json
```

## 注意点

- **temperatureの範囲**: 有効な値は 0.0 〜 1.0 です。0に近いほど決定論的（一貫性が高い）、1に近いほどランダム性が高くなります。

- **デフォルト値**: temperatureOverrideが設定されていない場合、デフォルトは 1.0 です。

- **修正前の動作**: v2.1.31以前では、ストリーミングAPIでこの設定が無視され、常に 1.0 が使用されていました。非ストリーミングAPIでは正しく動作していました。

- **設定の優先順位**: プロジェクトローカルの設定（`.claude/settings.json`）がグローバル設定（`~/.claude/settings.json`）より優先されます。

- **API直接利用時**: Claude APIを直接使用する場合は、リクエストごとにtemperatureパラメータを指定できます：
  ```bash
  curl https://api.anthropic.com/v1/messages \
    -H "anthropic-version: 2023-06-01" \
    -d '{
      "model": "claude-sonnet-4.5-20251101",
      "temperature": 0.7,
      "stream": true,
      ...
    }'
  ```

- **影響範囲**: この修正は、Claude Codeのストリーミング応答すべてに適用されます。対話的なチャット、コード生成、ファイル編集など、すべてのストリーミング操作が対象です。

## 関連情報

- [Claude Code settings - Claude Code Docs](https://code.claude.com/docs/en/settings)
- [Streaming Messages - Claude API Docs](https://platform.claude.com/docs/en/build-with-claude/streaming)
- [Claude API - Model Parameters](https://docs.claude.com/en/docs/build-with-claude/model-parameters)
- [Claude Code Changelog](https://github.com/anthropics/claude-code/blob/main/CHANGELOG.md)
