---
title: "複数行レスポンスでのテキストスタイルのずれを修正"
date: 2026-01-13
tags: ['バグ修正', 'UI', 'テキスト表示', 'フォーマット']
---

## 原文（日本語に翻訳）

複数行レスポンスでテキストスタイル（太字、色）が徐々にずれていく問題を修正

## 原文（英語）

Fixed text styling (bold, colors) getting progressively misaligned in multi-line responses

## 概要

Claude Code v2.1.6 では、テキストレンダリングの重要な問題が修正されました。以前のバージョンでは、Claude の長い応答において、太字やカラー表示などのテキストスタイルが徐々にずれ、意図しない位置にスタイルが適用されてしまう問題がありました。この修正により、長文の応答でも正確にフォーマットが適用されるようになりました。

## 基本的な使い方

この修正は自動的に適用され、ユーザー側での設定変更は不要です。

Claude の応答表示時:
1. 複数行にわたる長い応答が正しくフォーマットされる
2. 太字、イタリック、色付きテキストが意図した位置に表示される
3. コードブロックやリスト表示が正確に配置される

## 実践例

### 修正前の問題（v2.1.5以前）

長い応答で以下のような問題が発生していました:

```
# 最初の数行は正常
**これは太字です** 通常のテキスト

# しかし、応答が長くなると...
これは通常のテキストのはず**なのに太字になってしまう**
本来の太字部分 が通常表示になる

# さらに進むと色もずれる
エラーメッセージ（赤で表示されるべき）が通常色
通常テキストが赤くなってしまう
```

特に以下の場合に顕著でした:
- 100行以上の長い説明
- 多くのコードブロックを含む応答
- 色付きのログ出力を含む応答

### 修正後の動作（v2.1.6以降）

v2.1.6 では、全ての行で正確にスタイルが適用されます:

```
# 全ての行で正確なフォーマット
**これは太字です** 通常のテキスト

# 100行後でも正確
**ここも正しく太字** 通常のテキスト

# エラーメッセージも正しい色で表示
Error: ファイルが見つかりません（赤）
Success: 処理が完了しました（緑）
```

### コードブロックの正確な表示

複数のコードブロックを含む応答:

````markdown
以下のコードを実装してください:

```python
def hello():
    print("Hello, World!")
```

次に、以下のコードも追加:

```python
def goodbye():
    print("Goodbye!")
```

これらの関数は**正しく動作します**。
````

v2.1.6 では、コードブロック後のテキストスタイルが正しく適用されます。

### リストとフォーマットの組み合わせ

長いリスト内のフォーマット:

```markdown
以下の手順で実行してください:

1. **Step 1**: ファイルを開く
2. **Step 2**: 内容を編集する
3. **Step 3**: 保存する
...
50. **Step 50**: デプロイする

全てのステップで**太字が正確に適用**されます。
```

### カラー出力の正確な表示

ログやエラーメッセージの色分け:

```bash
# テストの実行結果
✓ test_login ... PASS (緑)
✓ test_logout ... PASS (緑)
✗ test_profile ... FAIL (赤)
⚠ test_settings ... WARN (黄)

# 100個のテスト後でも色が正確
✓ test_final ... PASS (緑)
```

### Markdown の複雑なフォーマット

見出し、リスト、コードを組み合わせた長文:

```markdown
## セクション1
これは**重要**です。

### サブセクション
- 項目1: `コード`
- 項目2: **太字**
- 項目3: *イタリック*

## セクション10
これらは全て**正しく表示**されます。
```

## 注意点

- この修正は Claude Code v2.1.6 で導入されました
- 特に長文の応答（100行以上）で効果が顕著です
- ANSI カラーコードを含むコマンド出力でも正しく動作します
- この問題は主に ink2 レンダリングエンジンで発生していました
- 修正により、端末のスクロール時のパフォーマンスも若干改善されています
- 既存の会話履歴は影響を受けず、新しい応答から修正が適用されます
- カスタムテーマを使用している場合でも、スタイルのずれは発生しなくなります

## 関連情報

- [Changelog v2.1.6](https://github.com/anthropics/claude-code/releases/tag/v2.1.6)
- [Claude Code テキスト表示設定](https://code.claude.com/docs/configuration#display)
- [Changelog v2.1.6 - ink2 mode visual artifacts fix](https://github.com/anthropics/claude-code/releases/tag/v2.1.6) - 関連する表示修正
