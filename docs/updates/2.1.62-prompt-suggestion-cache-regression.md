---
title: "プロンプト提案キャッシュのリグレッション修正によるキャッシュヒット率の改善"
date: 2026-02-27
tags: [バグ修正, パフォーマンス, キャッシュ, コスト最適化]
---

## 原文（日本語訳）

キャッシュヒット率を低下させていたプロンプト提案キャッシュのリグレッションを修正しました。

## 原文（英語）

Fixed prompt suggestion cache regression that reduced cache hit rates

## 概要

Claude Codeはシステムプロンプトをキャッシュすることで、API呼び出しの効率化とコスト削減を図っています。今回のバージョン2.1.62では、このキャッシュ機構にリグレッション（以前のバージョンで正常に動作していた機能が壊れること）が発生しており、キャッシュヒット率が低下していた問題を修正しました。この修正により、Claude Codeのレスポンス速度の向上とAPI使用コストの削減が期待できます。

## 基本的な使い方

この修正はユーザーが特別な操作をしなくても自動的に適用されます。Claude Codeを最新バージョンに更新するだけで恩恵を受けられます。

```bash
# Claude Codeを最新バージョンに更新
claude update
```

更新後にバージョンを確認して、2.1.62以降になっているかチェックします。

```bash
# 現在のバージョン確認
claude --version
```

## 実践例

### キャッシュの恩恵を確認する

Claude Codeのプロンプトキャッシュは、同一セッション内でシステムプロンプトが繰り返し使われるときに効果を発揮します。長いセッションほど、キャッシュヒットによるコスト削減効果が大きくなります。

```bash
# セッションの状態確認（キャッシュ情報を含む）
/status
```

### 長時間セッションでのパフォーマンス確認

リグレッション修正後は、特に以下のシナリオでパフォーマンス改善が見込めます。

```bash
# 複数のファイルを連続して編集する作業
# → セッション中にキャッシュが蓄積されるため、後半の応答が速くなる
claude "src/以下のすべてのTypeScriptファイルのimport文を整理してください"
```

### API使用量のモニタリング

キャッシュヒット率が改善することで、API使用量が減少します。Anthropicのダッシュボードでトークン使用量をモニタリングすることで、改善効果を確認できます。

```bash
# セッション統計の確認
/cost
```

### 繰り返し作業でのキャッシュ効果

同じプロジェクトを継続的に作業する場合、プロンプトキャッシュが特に有効です。

```bash
# プロジェクトの作業を再開
# → 以前のセッションのコンテキストをキャッシュから効率的に読み込み
claude --resume
```

## 注意点

- このバグはv2.1.14、v2.1.49、v2.1.50でも修正されており、今回は再度リグレッションが発生したものです
- プロンプトキャッシュはAnthropicのAPIレベルで行われるため、ユーザー側で設定する必要はありません
- キャッシュの有効期限はデフォルトで5分間（一部モデルでは1時間）です
- キャッシュヒット率はセッションの長さや、システムプロンプトの変更頻度に依存します
- CLAUDE.mdファイルや設定ファイルを頻繁に変更すると、キャッシュが無効化されやすくなります

## 関連情報

- [Claude Code 公式ドキュメント](https://code.claude.com/docs)
- [Anthropic プロンプトキャッシュ解説](https://docs.anthropic.com/en/docs/build-with-claude/prompt-caching)
- [Claude Code CHANGELOG](https://github.com/anthropics/claude-code/blob/main/CHANGELOG.md)
- [ClaudeLog - Changelog Mirror](https://claudelog.com/claude-code-changelog/)
