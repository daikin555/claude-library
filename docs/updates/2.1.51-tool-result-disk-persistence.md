---
title: "ツール結果のディスク永続化によるコンテキストウィンドウ使用量削減"
date: 2026-02-24
tags: [performance, context-window, disk-persistence, tool-results]
---

## 原文（日本語に翻訳）

50Kキャラクター以上のツール結果はディスクに永続化されるようになりました（以前は100K以上）。これにより、コンテキストウィンドウの使用量が削減され、会話の持続時間が改善されます。

## 原文（英語）

Tool results larger than 50K characters are now persisted to disk (previously 100K). This reduces context window usage and improves conversation longevity.

## 概要

Claude Codeがツール（Bash、ファイル読み取り等）の実行結果を処理する際の閾値が変更されました。50,000文字を超えるツール結果は、コンテキストウィンドウ内に直接保持される代わりにディスクに保存されます。以前は100,000文字が閾値でした。この変更により、大量の出力が発生するコマンドやファイル操作が行われた場合でも、コンテキストウィンドウが消耗しにくくなり、長期間の会話が可能になります。

## 基本的な使い方

この最適化は自動的に適用されます。ユーザー側での設定は不要です。

```bash
# 大量の出力が生成される場合でも、コンテキストが効率的に管理される
claude "すべてのログファイルを分析して異常を報告してください"
```

## 実践例

### 大規模なコードベース分析

大量の出力を生成する操作でも、長い会話を維持できます：

```bash
# プロジェクト全体の依存関係分析（大量の出力が発生する可能性）
claude "npm ls --all の出力を分析して、重複する依存関係と
       セキュリティリスクのあるパッケージを特定してください"
```

### ログファイルの分析

```bash
# 大きなログファイルを読み込んでも、コンテキストが維持される
claude "この1ヶ月分のアクセスログを読み込んで、
       エラーパターンと異常なアクセスを分析してください"
```

### 長時間の開発セッション

以前は大量の出力が発生するとコンテキストが詰まり、早期に会話をリセットする必要がありました：

```
以前（v2.1.50以前）：
- ツール結果 100K文字 → コンテキストウィンドウ内に保持
- 複数の大きな出力 → コンテキスト枯渇が早い
- 長いセッションで精度が低下することがある

改善後（v2.1.51以降）：
- ツール結果 50K〜100K文字 → ディスクに保存（参照のみ）
- コンテキストウィンドウの消費を抑制
- より長い会話が可能
```

### 効果が特に大きいシナリオ

```bash
# 大量のファイルを処理するタスク
claude "srcディレクトリ以下のすべてのファイルを読み込んで
       コードの品質評価を行ってください"

# 大きなデータセットの分析
claude "この大規模なCSVファイルを解析して統計情報を出してください"

# コマンドの大量出力
claude "git log --all --stat を実行して
       過去半年のコミット傾向を分析してください"
```

## 注意点

- ディスクに永続化された結果はセッション中にClaude Codeが必要に応じて参照します。通常の使用に影響はありません。
- 閾値が100Kから50Kに引き下げられたことで、より多くのツール結果がディスクに保存されるようになりました。ディスク容量が非常に限られている環境では注意が必要です。
- 永続化されたデータはセッション終了時に適切に管理されます。
- この変更はコンテキストウィンドウの「トークン消費」を最適化するためのものであり、会話の品質や精度には影響しません。

## 関連情報

- [Claude Code公式ドキュメント](https://code.claude.com/docs/en/overview)
- [Claude Code CHANGELOG](https://github.com/anthropics/claude-code/blob/main/CHANGELOG.md)
- [Claude Code GitHub](https://github.com/anthropics/claude-code)
