---
title: "マーケットプレイスソース削除時の設定クリーンアップ修正"
date: 2026-01-27
tags: [bugfix, marketplace, plugin, settings]
---

## 原文（日本語訳）
マーケットプレイスソースの削除時に設定が適切に削除されない問題が修正されました

## 原文（英語）
Fixed marketplace source removal not properly deleting settings

## 概要
プラグインマーケットプレイスのソースを削除した際、関連する設定ファイルが適切に削除されず、残存データが蓄積されていた問題が修正されました。これにより、マーケットプレイスの管理がよりクリーンになります。

## 問題の背景

### 修正前の問題
- マーケットプレイスソースを削除しても、設定ファイルが残った
- 削除したマーケットプレイスの設定が蓄積し、設定ファイルが肥大化
- 再度同じマーケットプレイスを追加すると、古い設定が影響する可能性があった

### 修正後
- マーケットプレイスソース削除時に関連設定も完全に削除される
- クリーンな状態が保たれる
- 設定ファイルの肥大化を防止

## 基本的な使い方

通常通りマーケットプレイスを削除するだけで、設定も自動的にクリーンアップされます。

```bash
claude
> /plugins marketplace
# マーケットプレイス一覧から削除したいものを選択
# ✅ 設定も自動的に削除される
```

## 実践例

### マーケットプレイスの削除

```bash
claude
> /plugins marketplace

# マーケットプレイス一覧:
# - Official Anthropic Marketplace
# - Custom Company Marketplace
# - Test Marketplace (削除したい)

# Test Marketplace を選択して削除
# ✅ マーケットプレイスと設定の両方が削除される
```

### 設定ファイルの確認

```bash
# 削除前の設定ファイル
~/.claude/settings.json
{
  "pluginMarketplaces": [
    "https://marketplace.example.com",
    "https://test-marketplace.example.com"
  ],
  "marketplaceSettings": {
    "https://test-marketplace.example.com": {
      "autoUpdate": true,
      "installedPlugins": [...]
    }
  }
}

# マーケットプレイス削除後
{
  "pluginMarketplaces": [
    "https://marketplace.example.com"
  ],
  "marketplaceSettings": {
    // ✅ test-marketplace の設定が削除されている
  }
}
```

### プロジェクト固有マーケットプレイスの削除

```bash
# プロジェクトの .claude/settings.json
{
  "extraKnownMarketplaces": [
    "https://team-marketplace.example.com"
  ]
}

# マーケットプレイスを削除
claude
> /plugins marketplace
# team-marketplace を削除

# 設定ファイル更新後:
{
  "extraKnownMarketplaces": []
  // ✅ 関連設定もすべて削除
}
```

### 古いマーケットプレイスのクリーンアップ

```bash
# 複数の古いマーケットプレイスを削除
claude
> /plugins marketplace

# 1つずつ削除していく:
# - Old Test Marketplace 1 → 削除
# - Old Test Marketplace 2 → 削除
# - Deprecated Marketplace → 削除

# ✅ それぞれの設定も完全に削除される
```

### マーケットプレイスの再追加

```bash
# 以前削除したマーケットプレイスを再追加
claude
> /plugins marketplace add https://test-marketplace.example.com

# ✅ 古い設定の影響を受けずクリーンな状態で追加される
```

## マーケットプレイス設定の構造

### 保存される設定

```json
{
  "pluginMarketplaces": [
    "https://marketplace.example.com"
  ],
  "marketplaceSettings": {
    "https://marketplace.example.com": {
      "autoUpdate": true,
      "lastSyncTime": "2026-01-27T10:00:00Z",
      "installedPlugins": [
        "plugin-1",
        "plugin-2"
      ],
      "enabledPlugins": [
        "plugin-1"
      ]
    }
  }
}
```

### 削除時にクリーンアップされる項目

- マーケットプレイス URL
- 自動更新設定
- インストール済みプラグインリスト
- 有効化済みプラグインリスト
- 同期タイムスタンプ
- その他マーケットプレイス固有の設定

## プラグイン管理の流れ

### マーケットプレイス追加からプラグイン削除まで

```bash
# 1. マーケットプレイス追加
claude
> /plugins marketplace add https://example.com/marketplace

# 2. プラグインインストール
> /plugins discover
# → マーケットプレイスから選択してインストール

# 3. プラグイン使用
# プラグインのスキルやコマンドを使用

# 4. プラグインアンインストール
> /plugins
# → インストール済みリストから削除

# 5. マーケットプレイス削除
> /plugins marketplace
# → マーケットプレイスを削除
# ✅ すべての関連設定が削除される
```

## 注意点

- **インストール済みプラグイン**: マーケットプレイスを削除する前に、そこからインストールしたプラグインも削除することを推奨します
- **プロジェクト設定**: プロジェクト固有の設定（`.claude/settings.json`）とユーザー設定（`~/.claude/settings.json`）は別々に管理されます
- **バックアップ**: 重要な設定がある場合、削除前にバックアップを取ることを推奨

## トラブルシューティング

### 設定が残っている場合

```bash
# 手動で設定ファイルを確認
cat ~/.claude/settings.json

# 不要な設定が残っている場合は手動で編集
vim ~/.claude/settings.json

# または設定をリセット
claude
> /config
# 設定をデフォルトに戻す
```

### マーケットプレイスが削除できない場合

```bash
# 1. インストール済みプラグインを先に削除
claude
> /plugins
# そのマーケットプレイスからのプラグインをすべてアンインストール

# 2. 再度マーケットプレイスを削除
> /plugins marketplace
# マーケットプレイスを選択して削除
```

### 古い設定の影響を受けている場合

```bash
# 設定ファイルを確認して手動クリーンアップ
# ~/.claude/settings.json を編集

# 特定のマーケットプレイス設定を削除
# marketplaceSettings から該当エントリを削除
```

## 設定ファイルの場所

### ユーザー設定
```
~/.claude/settings.json
```

### プロジェクト設定
```
<project-root>/.claude/settings.json
```

### 設定のバックアップ
```
~/.claude/settings.json.backup
```

## 関連コマンド

### マーケットプレイス管理
```bash
> /plugins marketplace        # マーケットプレイス一覧
> /plugins marketplace add    # マーケットプレイス追加
> /plugins marketplace remove # マーケットプレイス削除
```

### プラグイン管理
```bash
> /plugins                    # プラグイン一覧
> /plugins discover           # プラグイン検索
> /plugins enable             # プラグイン有効化
> /plugins disable            # プラグイン無効化
```

### 設定確認
```bash
> /config                     # 設定画面を開く
> /doctor                     # 診断（設定の問題をチェック）
```

## 関連情報

- [Claude Code Plugins Documentation](https://code.claude.com/docs/en/plugins)
- [Claude Code Plugin Marketplace](https://www.anthropic.com/news/claude-code-plugins)
- [Claude Code Changelog](https://claudefa.st/blog/guide/changelog)
