---
title: "Agent SDKã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã§ã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯é€šçŸ¥é…ä¿¡ã®ä¿®æ­£"
date: 2026-02-13
tags: [bugfix, agent-sdk, background-tasks, streaming]
---

## åŸæ–‡ï¼ˆæ—¥æœ¬èªï¼‰
Agent SDKã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã§ã€ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯ã®é€šçŸ¥ãŒé…ä¿¡ã•ã‚Œãªã„å•é¡Œã‚’ä¿®æ­£ã—ã¾ã—ãŸã€‚

## åŸæ–‡ï¼ˆè‹±èªï¼‰
Fixed background task notifications not being delivered in streaming Agent SDK mode

## æ¦‚è¦
Claude Code v2.1.41ã§ã¯ã€Agent SDKã‚’ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã§ä½¿ç”¨ã—ã¦ã„ã‚‹éš›ã«ã€ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‚¿ã‚¹ã‚¯ã®å®Œäº†é€šçŸ¥ã‚„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ãŒé…ä¿¡ã•ã‚Œãªã„å•é¡ŒãŒä¿®æ­£ã•ã‚Œã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Šã€éåŒæœŸã‚¿ã‚¹ã‚¯ã®ç›£è¦–ã¨ç®¡ç†ãŒæ­£å¸¸ã«æ©Ÿèƒ½ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

## å•é¡Œã®èƒŒæ™¯

### Agent SDKã¨ã¯
Agent SDKã¯ã€ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã€Claude Codeã®æ©Ÿèƒ½ã‚’æ‹¡å¼µã§ãã¾ã™ã€‚ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã§ã¯ã€å¿œç­”ãŒé€æ¬¡çš„ã«è¿”ã•ã‚Œã¾ã™ã€‚

### ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯
é•·æ™‚é–“å®Ÿè¡Œã•ã‚Œã‚‹ã‚¿ã‚¹ã‚¯ï¼ˆãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œã€ãƒ“ãƒ«ãƒ‰ã€ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãªã©ï¼‰ã¯ã€ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§éåŒæœŸå®Ÿè¡Œã•ã‚Œã€å®Œäº†æ™‚ã«é€šçŸ¥ãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚

### ç™ºç”Ÿã—ã¦ã„ãŸå•é¡Œ
ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ä½¿ç”¨æ™‚ã€ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã—ã¦ã‚‚é€šçŸ¥ãŒå±Šã‹ãšã€ã‚¿ã‚¹ã‚¯ã®çŠ¶æ…‹ã‚’ç¢ºèªã§ãã¾ã›ã‚“ã§ã—ãŸã€‚

## åŸºæœ¬çš„ãªä½¿ã„æ–¹

### ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯ã®å®Ÿè¡Œ
ä¿®æ­£å¾Œã¯ã€ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã§ã‚‚é€šçŸ¥ãŒæ­£å¸¸ã«é…ä¿¡ã•ã‚Œã¾ã™ã€‚

```bash
# ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
> "ãƒ†ã‚¹ãƒˆã‚’ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å®Ÿè¡Œã—ã¦ãã ã•ã„"

# ã‚¿ã‚¹ã‚¯ãŒãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§é–‹å§‹
ğŸ”„ Running tests in background (task_id: abc123)

# ä»–ã®ä½œæ¥­ã‚’ç¶™ç¶šå¯èƒ½
> "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°ã—ã¦ãã ã•ã„"

# ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯å®Œäº†æ™‚ã«é€šçŸ¥ãŒå±Šãï¼ˆä¿®æ­£å¾Œï¼‰
âœ… Background task completed: abc123
Test results: 42 passed, 0 failed
```

## å®Ÿè·µä¾‹

### é•·æ™‚é–“ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ã®ç›£è¦–
è¤‡é›‘ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ“ãƒ«ãƒ‰ã‚’ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å®Ÿè¡Œã—ãªãŒã‚‰ã€ä»–ã®ä½œæ¥­ã‚’ç¶™ç¶šã—ã¾ã™ã€‚

```bash
# ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰é–‹å§‹
> "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦ãã ã•ã„ï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ï¼‰"

ğŸ”„ Building project in background (task_id: build-001)

# ä»–ã®ã‚³ãƒ¼ãƒ‰ç·¨é›†ã‚’ç¶™ç¶š
> "èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä¿®æ­£ã—ã¦ãã ã•ã„"

# ãƒ“ãƒ«ãƒ‰å®Œäº†é€šçŸ¥ãŒé…ä¿¡ã•ã‚Œã‚‹ï¼ˆä¿®æ­£å¾Œï¼‰
âœ… Background task completed: build-001
Build successful: 234 files compiled, 0 errors

# ãƒ“ãƒ«ãƒ‰çµæœã‚’ç¢ºèª
> "ãƒ“ãƒ«ãƒ‰çµæœã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„"
```

### ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ä¸¦åˆ—å®Ÿè¡Œ
è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚¿ã‚¹ã‚¯ã‚’ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ä¸¦åˆ—å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
# 3ã¤ã®ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚¿ã‚¹ã‚¯ã‚’ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å®Ÿè¡Œ
> "3ã¤ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ä¸¦åˆ—å‡¦ç†ã—ã¦ãã ã•ã„"

ğŸ”„ Processing dataset A (task_id: proc-a)
ğŸ”„ Processing dataset B (task_id: proc-b)
ğŸ”„ Processing dataset C (task_id: proc-c)

# ä»–ã®ä½œæ¥­ã‚’ç¶™ç¶š
> "ãƒ¬ãƒãƒ¼ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„"

# å„ã‚¿ã‚¹ã‚¯å®Œäº†æ™‚ã«é€šçŸ¥ãŒé…ä¿¡ã•ã‚Œã‚‹ï¼ˆä¿®æ­£å¾Œï¼‰
âœ… Background task completed: proc-a
Dataset A processed: 10,000 records

âœ… Background task completed: proc-c
Dataset C processed: 8,500 records

âœ… Background task completed: proc-b
Dataset B processed: 12,300 records
```

### CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ç›£è¦–
è¤‡æ•°ã®CI/CDã‚¹ãƒ†ãƒ¼ã‚¸ã‚’ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å®Ÿè¡Œã—ã€é€²æ—ã‚’ç›£è¦–ã—ã¾ã™ã€‚

```bash
# CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³é–‹å§‹
> "CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„"

ğŸ”„ Stage 1: Linting (task_id: lint-001)
ğŸ”„ Stage 2: Unit tests (task_id: test-001)
ğŸ”„ Stage 3: Integration tests (task_id: integration-001)

# ä»–ã®é–‹ç™ºä½œæ¥­ã‚’ç¶™ç¶š
> "æ¬¡ã®æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„"

# å„ã‚¹ãƒ†ãƒ¼ã‚¸å®Œäº†æ™‚ã«é€šçŸ¥ãŒå±Šãï¼ˆä¿®æ­£å¾Œï¼‰
âœ… Background task completed: lint-001
Linting passed: 0 issues found

âœ… Background task completed: test-001
Unit tests passed: 156/156

âœ… Background task completed: integration-001
Integration tests passed: 23/23
```

### Agent SDKã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã®æ´»ç”¨
ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯ã‚’ä½¿ç”¨ã™ã‚‹ä¾‹ã§ã™ã€‚

```typescript
// custom-agent.ts
import { ClaudeAgentSDK } from 'claude-agent-sdk';

const agent = new ClaudeAgentSDK({
  streaming: true,  // ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹
});

// ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯ã‚’é–‹å§‹
agent.runInBackground(async (taskId) => {
  console.log(`Task ${taskId} started`);

  // é•·æ™‚é–“å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†
  await performHeavyComputation();

  // å®Œäº†é€šçŸ¥ï¼ˆä¿®æ­£å¾Œã¯æ­£å¸¸ã«é…ä¿¡ã•ã‚Œã‚‹ï¼‰
  return {
    status: 'completed',
    result: 'Computation finished'
  };
});
```

### ãƒãƒ«ãƒã‚¹ãƒ†ãƒƒãƒ—ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ç®¡ç†
è¤‡æ•°ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’æŒã¤ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
# ãƒãƒ«ãƒã‚¹ãƒ†ãƒƒãƒ—ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼é–‹å§‹
> "ãƒ‡ãƒ¼ã‚¿åé›†â†’å‡¦ç†â†’åˆ†æã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„"

ğŸ”„ Step 1: Data collection (task_id: wf-step1)
ğŸ”„ Step 2: Data processing (task_id: wf-step2)
ğŸ”„ Step 3: Data analysis (task_id: wf-step3)

# å„ã‚¹ãƒ†ãƒƒãƒ—ã®é€šçŸ¥ãŒé †æ¬¡é…ä¿¡ã•ã‚Œã‚‹ï¼ˆä¿®æ­£å¾Œï¼‰
âœ… Background task completed: wf-step1
Collected 50,000 records from API

âœ… Background task completed: wf-step2
Processed 50,000 records, cleaned 48,234

âœ… Background task completed: wf-step3
Analysis complete: Key insights saved to report.pdf
```

## ã“ã®ä¿®æ­£ã®åˆ©ç‚¹

### ã‚¿ã‚¹ã‚¯ç›£è¦–ã®æ”¹å–„
- ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯ã®çŠ¶æ…‹ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æŠŠæ¡
- å®Œäº†é€šçŸ¥ãŒç¢ºå®Ÿã«é…ä¿¡ã•ã‚Œã‚‹
- ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã§ã‚‚é€šçŸ¥ãŒæ©Ÿèƒ½

### éåŒæœŸå‡¦ç†ã®ä¿¡é ¼æ€§å‘ä¸Š
- é•·æ™‚é–“å®Ÿè¡Œã‚¿ã‚¹ã‚¯ã®ç®¡ç†ãŒå®¹æ˜“
- è¤‡æ•°ã‚¿ã‚¹ã‚¯ã®ä¸¦åˆ—å®Ÿè¡Œã‚’å®‰å¿ƒã—ã¦åˆ©ç”¨
- ã‚¿ã‚¹ã‚¯ã®å¤±æ•—ã‚„ã‚¨ãƒ©ãƒ¼ã‚‚é©åˆ‡ã«é€šçŸ¥

### é–‹ç™ºåŠ¹ç‡ã®å‘ä¸Š
- ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯ã‚’å¾…ã¤å¿…è¦ãŒãªã„
- ä¸¦åˆ—ä½œæ¥­ãŒå¯èƒ½
- ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®è‡ªå‹•åŒ–ãŒå®¹æ˜“

## ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯ã®ç®¡ç†ã‚³ãƒãƒ³ãƒ‰

### ã‚¿ã‚¹ã‚¯ä¸€è¦§ã®ç¢ºèª
```bash
# å®Ÿè¡Œä¸­ã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯ã‚’è¡¨ç¤º
> /tasks
```

### ã‚¿ã‚¹ã‚¯ã®å‡ºåŠ›ç¢ºèª
```bash
# ç‰¹å®šã®ã‚¿ã‚¹ã‚¯ã®å‡ºåŠ›ã‚’ç¢ºèª
> /task-output <task_id>
```

### ã‚¿ã‚¹ã‚¯ã®åœæ­¢
```bash
# ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯ã‚’åœæ­¢
> /task-stop <task_id>
```

## æ³¨æ„ç‚¹
- ã“ã®ä¿®æ­£ã¯ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã§ã®Agent SDKä½¿ç”¨æ™‚ã«ã®ã¿é©ç”¨ã•ã‚Œã¾ã™
- ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯ã®å®Ÿè¡Œã«ã¯ã€é©åˆ‡ãªæ¨©é™ã¨ãƒªã‚½ãƒ¼ã‚¹ãŒå¿…è¦ã§ã™
- å¤§é‡ã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯ã‚’åŒæ™‚å®Ÿè¡Œã™ã‚‹ã¨ã€ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹ã«å½±éŸ¿ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™
- ã‚¿ã‚¹ã‚¯ã®é€šçŸ¥ã¯ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«è¡¨ç¤ºã•ã‚Œã¾ã™ãŒã€å±¥æ­´ã¯`/tasks`ã‚³ãƒãƒ³ãƒ‰ã§ç¢ºèªã§ãã¾ã™

## Agent SDKã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã®è¨­å®š

### ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹åŒ–
```typescript
// agent-config.ts
import { ClaudeAgentSDK } from 'claude-agent-sdk';

const agent = new ClaudeAgentSDK({
  streaming: true,  // ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰
  backgroundTasks: true,  // ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯æœ‰åŠ¹åŒ–
});
```

## é–¢é€£æƒ…å ±
- [Claude Code - How it works](https://code.claude.com/docs/en/how-claude-code-works)
- [Agent SDK Documentation](https://code.claude.com/docs/en/agent-sdk)
- [Background Tasks Guide](https://code.claude.com/docs/en/background-tasks)
