---
title: "バックグラウンドエージェント実行中のCtrl+C・ESC無視バグを修正"
date: 2026-02-22
tags: [bug-fix, keyboard-shortcut, background-agents, ux]
---

## 原文（日本語に翻訳）

バックグラウンドエージェントが実行中でメインスレッドがアイドル状態のとき、Ctrl+CとESCが無視されていた問題を修正しました。3秒以内に2回押すと、すべてのバックグラウンドエージェントが終了するようになりました。

## 原文（英語）

Fixed Ctrl+C and ESC being silently ignored when background agents are running and the main thread is idle. Pressing twice within 3 seconds now kills all background agents.

## 概要

バックグラウンドエージェントが実行中で、かつメインスレッドがアイドル状態（入力待ち）のときに `Ctrl+C` や `ESC` を押しても無視されていた問題が修正されました。修正後は、3秒以内に2回押すことですべてのバックグラウンドエージェントを終了できます。なお、専用のキーバインドとして `Ctrl+F` も同様の機能を持ちます。

## 基本的な使い方

```
バックグラウンドエージェントが実行中でメインスレッドがアイドルのとき:
  Ctrl+C または ESC        → 「もう一度押してください」と表示
  Ctrl+C または ESC（再度） → 3秒以内に押すと全エージェントを終了
```

## 実践例

### ユースケース1: エージェント実行中にCtrl+Cで中断

```bash
# バックグラウンドでエージェントが実行中
# メインスレッドは入力待ち状態

# 以前（バグあり）: Ctrl+C を押しても何も起きない
# 修正後: 確認プロンプトが表示される
[Ctrl+C を押す]
# → "バックグラウンドエージェントが実行中です。もう一度押して終了してください"

[Ctrl+C をもう一度押す（3秒以内）]
# → すべてのバックグラウンドエージェントが終了
```

### ユースケース2: ESCキーで緊急停止

```bash
# ESCキーでも同様の動作が可能
[ESC を押す]
# → 確認プロンプト表示

[ESC をもう一度押す（3秒以内）]
# → 全エージェント終了
```

### ユースケース3: 誤操作防止の確認フロー

```bash
# 3秒以上経過した場合はキャンセル扱い
[Ctrl+C を押す]
# → 確認プロンプト表示

# 3秒以上待つと...
# → キャンセルされ、エージェントは継続動作
```

## 注意点

- 2回の押下は **3秒以内** に行う必要があります。3秒を超えるとキャンセルとみなされます。
- この修正はメインスレッドがアイドル状態のときに適用されます。メインスレッドが作業中の場合は従来どおりの動作です。
- `Ctrl+F` も同様にバックグラウンドエージェントを終了できます（専用キーバインド）。
- エージェントを終了すると、進行中の作業は失われます。

## 関連情報

- [Claude Code 公式ドキュメント](https://docs.anthropic.com/ja/docs/claude-code/overview)
- [Claude Code CHANGELOG](https://github.com/anthropics/claude-code/blob/main/CHANGELOG.md)
- [Ctrl+Fでバックグラウンドエージェントを終了](./2.1.49-ctrl-f-kill-background-agents.md)
- [background: trueでバックグラウンド実行](./2.1.49-background-agent-definition.md)
