---
title: "MCPサーバー認証失敗のキャッシュによるパフォーマンス改善"
date: 2026-02-22
tags: [performance, mcp, authentication, caching]
---

## 原文（日本語に翻訳）

HTTPおよびSSE MCPサーバーの認証失敗をキャッシュすることでパフォーマンスを改善しました。認証が必要なサーバーへの再接続試行が繰り返されなくなります。

## 原文（英語）

Improved performance by caching authentication failures for HTTP and SSE MCP servers, avoiding repeated connection attempts to servers requiring auth

## 概要

MCPサーバー（HTTPおよびSSEトランスポート）への接続が認証エラーで失敗した場合、その失敗をキャッシュすることで、不要な再接続試行を繰り返さないように改善されました。これにより、認証設定が不完全なMCPサーバーが存在する環境でも、起動時や操作中のパフォーマンスが向上します。

## 基本的な使い方

この改善はバックグラウンドで自動的に適用されます。MCPサーバーの設定自体に変更は不要です。

```bash
# MCPサーバーが設定されている状態でClaudeを起動
claude
# → 認証失敗がキャッシュされ、無駄な再接続が発生しない
```

## 実践例

### ユースケース1: 認証が必要なMCPサーバーが混在する環境

```json
// settings.json のMCP設定例
{
  "mcpServers": {
    "authenticated-server": {
      "url": "https://mcp.example.com/sse",
      "transport": "sse"
    },
    "public-server": {
      "url": "https://public-mcp.example.com/sse",
      "transport": "sse"
    }
  }
}
```

```bash
# 以前: authenticated-serverへの接続を毎回試みてタイムアウト待ち
# 修正後: 最初の失敗がキャッシュされ、以降は再試行しない
claude
# → 起動が高速化
```

### ユースケース2: CI/CDパイプラインでの使用

```bash
# 自動化環境で認証情報が不完全な場合
# 以前: 各実行でMCPサーバーへの接続試行が繰り返され遅延
# 修正後: 認証失敗がキャッシュされ効率化

claude -p "コードを解析してください"
# → 不要なネットワーク待機が発生しない
```

### ユースケース3: 一時的に認証トークンが失効している場合

```bash
# 認証トークンの有効期限が切れた状態
# キャッシュにより同じサーバーへの繰り返しの再試行を防止
# → セッション中のパフォーマンスが安定
```

## 注意点

- 認証失敗のキャッシュはセッション内で有効です。認証設定を修正した場合は、Claude Codeを再起動してキャッシュをクリアしてください。
- HTTPおよびSSEトランスポートのMCPサーバーに適用されます（stdioトランスポートは対象外）。
- 起動時のMCP認証失敗キャッシュについては `2.1.49-startup-mcp-auth-caching.md` も参照してください。

## 関連情報

- [Claude Code MCPドキュメント](https://docs.anthropic.com/ja/docs/claude-code/mcp)
- [Claude Code CHANGELOG](https://github.com/anthropics/claude-code/blob/main/CHANGELOG.md)
- [起動時MCP認証キャッシュ](./2.1.49-startup-mcp-auth-caching.md)
- [MCP OAuth認証改善](./2.1.49-mcp-oauth-step-up-auth.md)
