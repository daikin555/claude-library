---
title: "サブエージェントのWeb検索時のモデル選択エラーを修正"
date: 2026-01-09
tags: ['バグ修正', 'サブエージェント', 'Web検索', 'モデル選択']
---

## 原文（日本語に翻訳）

サブエージェント内でのWeb検索実行時に、誤ったモデルが使用される問題を修正しました

## 原文（英語）

Fixed web search in sub-agents using incorrect model

## 概要

Claude Code v2.1.3では、サブエージェントがWeb検索を実行する際に、意図したものとは異なるモデルが使用される問題が修正されました。この修正により、サブエージェントに指定したモデルがWeb検索処理でも一貫して使用され、期待通りの動作とコスト効率が実現されます。

## 基本的な使い方

サブエージェントは、必要に応じて自動的にWeb検索を実行します。

```bash
# Web検索が必要なタスクの例
# 「最新のReact 19のドキュメントを調べて」
# → サブエージェントが自動的にWeb検索を実行
# → v2.1.3では指定したモデルが正しく使用される
```

## 実践例

### 修正前の問題

サブエージェントでHaikuを指定しても、Web検索時に別のモデルが使用されることがありました。

```bash
# 修正前の動作例
# 1. Haikuモデルでサブエージェントを起動
#    - 高速・低コストな処理を期待
# 2. タスク中にWeb検索が必要になる
# 3. Web検索時にSonnetモデルに切り替わる（意図しない動作）
#    - コストが増加
#    - パフォーマンスの不一致
```

### 修正後の動作

v2.1.3では、Web検索でも指定したモデルが維持されます。

```bash
# 修正後の動作例
# 1. Haikuモデルでサブエージェントを起動
#    - 高速・低コストな処理を期待
# 2. タスク中にWeb検索が必要になる
# 3. Web検索でもHaikuモデルを使用✅
#    - 一貫したパフォーマンス
#    - 予測可能なコスト
```

### Web検索を含むタスクの例

最新情報の調査や技術ドキュメントの検索でサブエージェントを活用する場合です。

```bash
# ユースケース1：最新のライブラリ情報を調査
# タスク：「Next.js 15の新機能を調べて、プロジェクトへの影響を分析して」
#
# v2.1.3での動作：
# 1. サブエージェント起動（Haikuで高速処理）
# 2. Web検索でNext.js 15の情報を取得（Haikuを使用）
# 3. 分析結果を生成（Haikuを使用）
# → 全体を通じてHaikuモデルで一貫して処理

# ユースケース2：エラー調査
# タスク：「このエラーメッセージの解決方法を検索して」
#
# v2.1.3での動作：
# 1. サブエージェント起動（Sonnetで高品質な分析）
# 2. Web検索でエラー情報を収集（Sonnetを使用）
# 3. 解決策を提案（Sonnetを使用）
# → 全体を通じてSonnetモデルで高品質な結果
```

### モデル選択のベストプラクティス

タスクの性質に応じてモデルを選択します。

```bash
# 高速な情報収集タスク → Haiku
# 例：
# - APIドキュメントの参照
# - エラーメッセージの簡易検索
# - 基本的な使用例の検索

# 詳細な分析が必要なタスク → Sonnet
# 例：
# - 複雑な技術的問題の調査
# - 複数ソースからの情報統合
# - ベストプラクティスの詳細な分析
```

### コスト最適化の例

適切なモデル選択により、コストを最適化できます。

```bash
# シナリオ：複数の調査タスク
#
# タスク1：「最新のTypeScript構文を調べて」
# → Haiku使用（単純な情報収集）
#
# タスク2：「この設計パターンの長所と短所を詳しく分析して」
# → Sonnet使用（詳細な分析が必要）
#
# v2.1.3では、各タスクで指定したモデルが
# Web検索を含むすべての処理で一貫して使用される
```

## 注意点

- この修正は自動的に適用され、ユーザー側での設定変更は不要です
- Web検索を含むタスクでは、サブエージェントのモデル選択がより重要になります
  - 単純な検索：Haiku（高速・低コスト）
  - 複雑な調査：Sonnet（高品質・詳細）
- Web検索の頻度が高いタスクでは、v2.1.3へのアップデートによるコスト削減効果が大きくなります
- Web検索の結果品質は、指定したモデルの性能に依存します

## 関連情報

- [Claude Code 公式ドキュメント](https://claude.ai/code)
- [Changelog v2.1.3](https://github.com/anthropics/claude-code/releases/tag/v2.1.3)
- [サブエージェントの使い方](https://github.com/anthropics/claude-code)
- [Web検索機能のガイド](https://github.com/anthropics/claude-code)
- [モデル選択とコスト最適化](https://github.com/anthropics/claude-code)
