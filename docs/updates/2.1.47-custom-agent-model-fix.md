---
title: "カスタムエージェントのmodelフィールドが無視される問題の修正"
date: 2026-02-19
tags: [bug-fix, agents, model, configuration]
---

## 原文（日本語に翻訳）

チームメイトをスポーンする際に `.claude/agents/*.md` 内のカスタムエージェントの `model` フィールドが無視されていた問題を修正しました（anthropics/claude-code#26064）

## 原文（英語）
Fixed custom agent `model` field in `.claude/agents/*.md` being ignored when spawning team teammates (anthropics/claude-code#26064)

## 概要

`.claude/agents/` ディレクトリに配置するカスタムエージェント定義ファイルでは、使用するモデルを `model` フィールドで指定できます。しかし、チームメイトとしてエージェントをスポーンする際にこの設定が無視され、デフォルトモデルが使用されていました。この修正により、カスタムエージェントで指定したモデルが正しく反映されるようになります。

## 基本的な使い方

`.claude/agents/` ディレクトリにエージェント定義ファイルを作成し、`model` フィールドでモデルを指定します。

```markdown
<!-- .claude/agents/fast-reviewer.md -->
---
name: fast-reviewer
model: claude-haiku-4-5
description: "高速コードレビューエージェント"
---

あなたは高速なコードレビュアーです。簡潔にフィードバックを提供してください。
```

このエージェントをスポーンすると、指定した `claude-haiku-4-5` モデルが使用されます。

## 実践例

### ユースケース1: コスト最適化のためのモデル指定

タスクの複雑さに応じて異なるモデルを使うエージェントを定義できます。

```markdown
<!-- .claude/agents/simple-tasks.md -->
---
name: simple-tasks
model: claude-haiku-4-5
description: "シンプルなタスク用の軽量エージェント"
---

あなたはシンプルなタスクを効率的に処理するエージェントです。
ファイルの整形、簡単なリネーム、定型的な変換を担当します。
```

```markdown
<!-- .claude/agents/complex-analysis.md -->
---
name: complex-analysis
model: claude-opus-4-6
description: "複雑な分析用の高性能エージェント"
---

あなたは複雑なアーキテクチャ設計や深い技術的分析を行うエージェントです。
```

### ユースケース2: チームメイトとしてのスポーン

定義したエージェントをClaude Codeセッション内でチームメイトとして使用する場合、モデル指定が正しく反映されます。

```bash
# Claude Codeでエージェントを呼び出す例
claude

> @fast-reviewer このPRのコードレビューをお願いします
# → fast-reviewerエージェントがclaude-haiku-4-5で起動する（修正後の動作）
```

### ユースケース3: 設定の確認

エージェントのモデル設定が正しく適用されているか確認するには、エージェントのレスポンス速度や動作を観察します。

```bash
# エージェント定義の確認
cat .claude/agents/fast-reviewer.md

# 期待されるフロントマター
---
name: fast-reviewer
model: claude-haiku-4-5
description: "高速コードレビューエージェント"
---
```

## 注意点

- `model` フィールドには有効なClaude モデルIDを指定する必要があります（例: `claude-opus-4-6`, `claude-haiku-4-5`）。
- 指定したモデルがご利用のAPIキーでアクセス可能である必要があります。
- この修正はチームメイトとしてスポーンする場合に関するものです。通常の単独エージェント起動も影響を受ける場合があります。
- `.claude/agents/` ディレクトリはプロジェクトルートまたはホームディレクトリに配置できます。
- カスタムエージェント機能はClaude Code v2.1.0以降でサポートされています。

## 関連情報

- [Claude Code 公式ドキュメント - カスタムエージェント](https://docs.anthropic.com/ja/docs/claude-code/overview)
- [Claude Code CHANGELOG](https://github.com/anthropics/claude-code/blob/main/CHANGELOG.md)
- [GitHub Issue #26064](https://github.com/anthropics/claude-code/issues/26064)
- [サブエージェントとツール使用](https://docs.anthropic.com/ja/docs/agents-and-tools)
