---
title: "BedrockとVertexでalwaysThinkingEnabledが機能しない問題の修正"
date: 2026-02-19
tags: [bug-fix, thinking, bedrock, vertex, settings]
---

## 原文（日本語に翻訳）

settings.json の `alwaysThinkingEnabled: true` がBedrockおよびVertexプロバイダーでシンキングモードを有効化しない問題を修正しました（anthropics/claude-code#26074）

## 原文（英語）
Fixed `alwaysThinkingEnabled: true` in settings.json not enabling thinking mode on Bedrock and Vertex providers (anthropics/claude-code#26074)

## 概要

Claude Codeの `settings.json` に `alwaysThinkingEnabled: true` を設定することで、常にシンキングモード（拡張思考モード）を有効にできます。しかし、Amazon BedrockおよびGoogle Vertex AIを通じてClaude Codeを利用している場合、この設定が正しく反映されず、シンキングモードが有効になっていませんでした。この修正により、BedrockとVertexプロバイダーでも `alwaysThinkingEnabled` 設定が正しく機能するようになります。

## 基本的な使い方

`settings.json` に `alwaysThinkingEnabled: true` を設定します。

```json
// ~/.claude/settings.json または プロジェクトの .claude/settings.json
{
  "alwaysThinkingEnabled": true
}
```

修正後は、Bedrock・Vertex環境でも常にシンキングモードが有効になります。

## 実践例

### ユースケース1: Amazon Bedrockでの設定

AWS BedrockでClaude Codeを使用している場合の設定例。

```bash
# AWS Bedrock用の環境変数設定
export ANTHROPIC_API_KEY=""
export AWS_BEDROCK_ARN="arn:aws:bedrock:us-east-1::foundation-model/anthropic.claude-opus-4-6-v1:0"

# settings.jsonの設定
cat ~/.claude/settings.json
```

```json
{
  "alwaysThinkingEnabled": true,
  "model": "anthropic.claude-opus-4-6-v1:0"
}
```

```bash
# 起動後、シンキングモードが有効になっていることを確認
claude

> 複雑なアルゴリズムの最適化について考えてください
# 修正後: Claudeが内部で思考プロセスを実行してから回答する
```

### ユースケース2: Google Vertex AIでの設定

Google Cloud Vertex AIを使用している場合の設定例。

```bash
# Vertex AI用の環境変数設定
export ANTHROPIC_VERTEX_PROJECT_ID="my-gcp-project"
export CLOUD_ML_REGION="us-east5"

# settings.jsonの設定
cat ~/.claude/settings.json
```

```json
{
  "alwaysThinkingEnabled": true,
  "model": "claude-opus-4-6@20250514"
}
```

```bash
claude

> このシステムアーキテクチャの問題点を深く分析してください
# 修正後: シンキングモードが有効になり、より深い分析が行われる
```

### ユースケース3: プロジェクト固有の設定

特定のプロジェクトでのみシンキングモードを有効にする場合。

```bash
# プロジェクトのルートディレクトリに設定ファイルを作成
mkdir -p .claude

cat > .claude/settings.json << 'EOF'
{
  "alwaysThinkingEnabled": true
}
EOF

# このプロジェクトディレクトリからClaude Codeを起動すると
# BedrockやVertexでも常にシンキングモードが有効になる
claude
```

## 注意点

- シンキングモードを常に有効にすると、応答時間が長くなる場合があります。
- シンキングモードは一部のモデルのみでサポートされています（Claude Opus 4.x 以降が推奨）。
- Bedrockでの利用にはAWS IAMの適切な権限設定が必要です。
- Vertex AIでの利用にはGCPの適切なサービスアカウント設定が必要です。
- `alwaysThinkingEnabled` は直接APIを使用する場合（`ANTHROPIC_API_KEY` 環境変数）でも機能します。この修正はBedrockとVertex特有の問題でした。

## 関連情報

- [Claude Code 公式ドキュメント](https://docs.anthropic.com/ja/docs/claude-code/overview)
- [Claude Code CHANGELOG](https://github.com/anthropics/claude-code/blob/main/CHANGELOG.md)
- [GitHub Issue #26074](https://github.com/anthropics/claude-code/issues/26074)
- [拡張思考（Extended Thinking）について](https://docs.anthropic.com/ja/docs/build-with-claude/extended-thinking)
- [Amazon Bedrock でのClaude利用](https://docs.anthropic.com/ja/docs/claude-code/amazon-bedrock)
- [Google Vertex AI でのClaude利用](https://docs.anthropic.com/ja/docs/claude-code/google-vertex-ai)
