---
title: "CJK全角文字によるTUIのタイムスタンプとレイアウトのズレ修正"
date: 2026-02-19
tags: [bug-fix, cjk, tui, layout, i18n]
---

## 原文（日本語に翻訳）

CJK全角文字がTUI内のタイムスタンプやレイアウト要素の位置ズレを引き起こしていた問題を修正しました（anthropics/claude-code#26084）

## 原文（英語）
Fixed CJK wide characters causing misaligned timestamps and layout elements in the TUI (anthropics/claude-code#26084)

## 概要

日本語・中国語・韓国語などのCJK（Chinese, Japanese, Korean）全角文字は、ASCII文字と比べて2倍の表示幅を持ちます。この特性がClaude CodeのTUI（テキストユーザーインターフェース）上でレイアウト計算の誤りを引き起こし、タイムスタンプや各種UI要素の位置がズレて表示されていました。この修正により、CJK文字を含むコンテンツでも正しく整列されたレイアウトが表示されるようになります。

## 基本的な使い方

修正後は、日本語などのCJK文字を含むコンテンツをClaude Codeで扱う際に、TUIのレイアウトが正しく表示されます。

```bash
# 日本語でClaude Codeを使用する例
claude

> 以下のコードを日本語でコメントを付けてリファクタリングしてください：
> function add(a, b) { return a + b; }
```

修正前は日本語のレスポンスが表示された際にタイムスタンプや区切り線がズレていましたが、修正後は正しく表示されます。

## 実践例

### ユースケース1: 日本語コンテンツの処理

日本語のファイル名、コメント、コードを含むプロジェクトで作業する場合でも、UIが正しく表示されます。

```bash
# 日本語のファイルを操作する例
claude

> 以下のPythonファイルを確認してください：
> ファイル名: データ処理.py
> 内容を要約して改善点を教えてください
```

TUIには以下のように整列されたレイアウトで表示されます（修正後）：
```
[応答内容]                    10:30:45
日本語のコメントを含むコード...
                              ^^^^^^^^
                              タイムスタンプが正しく右端に表示
```

### ユースケース2: 中国語・韓国語コンテンツ

中国語（繁体字・簡体字）や韓国語のコンテンツを扱う場合も同様に修正が適用されます。

```bash
# 多言語プロジェクトでの使用例
claude

> このコードに中国語のドキュメントを追加してください
> 対象: api_handler.py
```

### ユースケース3: 混在コンテンツ（CJK + 英字）

CJK文字と英数字が混在するコンテンツでも正しくレイアウトが計算されます。

```bash
claude

> 「ユーザー認証 (User Authentication)」機能の実装方法を説明してください
```

## 注意点

- この修正はTUIの表示に関するものです。Claude Codeの処理機能自体には影響しません。
- CJK文字の幅計算にはUnicode標準のEast Asian Width仕様が適用されています。
- ターミナルエミュレータ自体のCJK文字幅の設定（全角/半角の扱い）が正しく設定されていることが前提です。
- フォントによっては引き続き表示がズレる場合があります。その際はターミナルのフォント設定を確認してください。

## 関連情報

- [Claude Code 公式ドキュメント](https://docs.anthropic.com/ja/docs/claude-code/overview)
- [Claude Code CHANGELOG](https://github.com/anthropics/claude-code/blob/main/CHANGELOG.md)
- [GitHub Issue #26084](https://github.com/anthropics/claude-code/issues/26084)
- [Unicode East Asian Width 仕様](https://www.unicode.org/reports/tr11/)
