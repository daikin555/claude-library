---
title: "エージェントのメモリ永続化機能の追加"
date: 2026-02-06
tags: [feature, agents, memory, persistence, configuration]
---

## 原文（日本語）
エージェント向けに `memory` frontmatterフィールドのサポートが追加され、`user`、`project`、または `local` スコープで永続的なメモリを有効にできるようになりました。

## 原文（英語）
Added `memory` frontmatter field support for agents, enabling persistent memory with `user`, `project`, or `local` scope

## 概要
カスタムエージェントの定義に `memory` frontmatterフィールドが追加され、エージェントが過去の経験や学習内容を記憶し続けることができるようになりました。メモリのスコープは、ユーザー全体（`user`）、プロジェクト単位（`project`）、またはローカル限定（`local`）から選択できます。

## 基本的な使い方

エージェント定義ファイルのfrontmatterで、`memory` フィールドを指定します。

```markdown
---
name: learning-agent
description: 学習内容を記憶するエージェント
memory: project
tools:
  - Read
  - Write
  - Edit
---

このエージェントは、プロジェクト内で学習した内容を記憶します。
```

## 実践例

### プロジェクト固有の学習エージェント

プロジェクトのコーディング規約やパターンを学習し、記憶するエージェント：

```markdown
---
name: project-style-guide
description: プロジェクトのコーディングスタイルを学習
memory: project
tools:
  - Read
  - Grep
  - Glob
  - Write
---

このエージェントは、プロジェクト固有のコーディングスタイル、
命名規則、アーキテクチャパターンを学習し、
一貫性のあるコードレビューやリファクタリングを提供します。

## 学習内容
- コンポーネントの構造パターン
- 変数・関数の命名規則
- エラーハンドリングのベストプラクティス
- プロジェクト固有の用語集
```

### ユーザー全体で共有する開発アシスタント

すべてのプロジェクトで学習内容を共有するエージェント：

```markdown
---
name: personal-dev-assistant
description: 個人的な開発アシスタント
memory: user
tools:
  - Read
  - Write
  - Edit
  - Bash
  - Task(Bash)
  - Task(Explore)
---

このエージェントは、あなたの開発スタイル、
よく使うツール、過去の問題解決方法を学習し、
すべてのプロジェクトで活用します。

## 記憶する内容
- よく使うコマンドやスクリプト
- デバッグ手法
- あなた固有の開発フロー
- 過去に解決した類似の問題
```

### ローカル限定の一時的学習エージェント

特定のセッション内でのみメモリを保持するエージェント：

```markdown
---
name: session-researcher
description: セッション内で調査結果を保持
memory: local
tools:
  - Read
  - Grep
  - WebFetch
  - WebSearch
---

このエージェントは、現在のセッション内でのみ調査結果を記憶します。
セッションが終了すると、メモリはクリアされます。
```

### デバッグパターン学習エージェント

過去のバグ修正パターンを学習し、同様の問題を迅速に解決：

```markdown
---
name: debug-expert
description: デバッグパターンを学習するエージェント
memory: project
tools:
  - Read
  - Grep
  - Bash
  - Task(Bash)
  - Edit
---

このエージェントは、プロジェクト内で過去に発生したバグと
その修正方法を記憶し、類似の問題を素早く特定・解決します。

## 学習内容
- よくあるバグのパターン
- 効果的だった修正手法
- テストケースの追加箇所
- 再発防止の実装パターン
```

### API統合学習エージェント

プロジェクトで使用する外部APIの特性を学習：

```markdown
---
name: api-integration-expert
description: プロジェクトのAPI統合に特化
memory: project
tools:
  - Read
  - Grep
  - WebFetch
  - Write
---

このエージェントは、プロジェクトで使用している外部APIの
仕様、レート制限、エラーハンドリング方法を学習し、
効率的なAPI統合をサポートします。

## 記憶内容
- APIエンドポイントとパラメータ
- レート制限とリトライ戦略
- 認証フロー
- よくあるエラーとその対処法
```

### テスト戦略学習エージェント

プロジェクトのテスト戦略とパターンを学習：

```markdown
---
name: test-strategy-expert
description: テスト戦略を学習し適用
memory: project
tools:
  - Read
  - Grep
  - Write
  - Task(Bash)
---

このエージェントは、プロジェクトのテスト戦略、
よく使うテストパターン、モックの作り方を学習し、
一貫性のあるテストコードを提案します。

## 学習内容
- テストファイルの構造
- よく使うアサーション
- モック・スタブのパターン
- カバレッジ要件
```

## 注意点

### メモリスコープの選択基準

- **`user`**: すべてのプロジェクトで学習内容を共有したい場合
  - 個人的なコーディングスタイル
  - 汎用的な問題解決パターン
  - よく使うツールやコマンド

- **`project`**: プロジェクト固有の知識を保持したい場合（推奨）
  - プロジェクトのアーキテクチャ
  - コーディング規約
  - プロジェクト固有のAPI仕様

- **`local`**: 一時的な実験やセンシティブな情報を扱う場合
  - 一時的な調査作業
  - プロトタイピング
  - セキュリティ上の理由でメモリを永続化したくない場合

### 実装上の注意点

- メモリファイルは、Claude Codeのデータディレクトリ（通常は `~/.claude/`）に保存されます
- `memory` フィールドを指定しない場合、エージェントはメモリを永続化しません（デフォルト動作）
- メモリの内容は、エージェントが自動的に更新・管理します
- メモリファイルのサイズが大きくなりすぎないよう、エージェントは重要な情報のみを保存します
- センシティブな情報（APIキー、パスワードなど）がメモリに保存されないよう注意してください
- メモリの内容は、`~/.claude/memory/` ディレクトリで確認できます

### セキュリティとプライバシー

- `user` スコープのメモリは、複数のプロジェクト間で共有されるため、プロジェクト固有の機密情報が漏れないよう注意が必要です
- チーム開発の場合、`project` スコープのメモリをバージョン管理システムに含めないよう、`.gitignore` に追加することを検討してください
- メモリファイルには、コードスニペットやプロジェクト情報が含まれる可能性があるため、定期的にレビューすることを推奨します

## 関連情報

- [Claude Agent SDK公式ドキュメント](https://docs.anthropic.com/claude/docs/agent-sdk)
- [カスタムエージェントの作成ガイド](https://docs.anthropic.com/claude/docs/custom-agents)
- [エージェントメモリのベストプラクティス](https://docs.anthropic.com/claude/docs/agent-memory)
- [Automatic Memoryガイド](/updates/2.1.32-automatic-memory)
