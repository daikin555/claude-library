---
title: "バックグラウンドエージェントの起動時権限確認"
date: 2026-01-27
tags: [change, security, permissions, background-tasks]
---

## 原文（日本語訳）
バックグラウンドエージェントを起動前にツール権限の確認を求めるように変更しました

## 原文（英語）
Changed background agents to prompt for tool permissions before launching

## 概要
バックグラウンドで実行されるエージェントが、起動前に必要なツールの使用許可を求めるようになりました。これにより、意図しないツール実行を防ぎ、セキュリティが向上します。

## 基本的な使い方

バックグラウンドエージェントを起動する際、権限確認が表示されます。

## 実践例

### バックグラウンドタスクの起動

```bash
claude
> バックグラウンドでテストスイートを実行してください

Background agent requires permissions:
- Bash (npm test)
- Read (test results)
- Write (test reports)

Allow these permissions? [y/N]
```

許可すると、バックグラウンドで実行されます：

```bash
> y
✓ Background agent started (ID: task-123)
```

### 複数ツールの権限確認

```bash
claude
> バックグラウンドで依存関係を更新して、レポートを作成してください

Background agent requires permissions:
- Bash (npm update, npm audit)
- Read (package.json, package-lock.json)
- Write (dependency-report.md)
- Fetch (npm registry)

Allow these permissions? [y/N]
```

### 権限の個別設定

すべてを許可したくない場合、個別に設定できます：

```bash
Background agent requires permissions:
- Bash (npm test)
- Read (test results)
- Write (/tmp/test-output.log)

Options:
1. Allow all
2. Customize permissions
3. Deny

Choose [1-3]: 2

Bash (npm test) - Allow? [Y/n] y
Read (test results) - Allow? [Y/n] y
Write (/tmp/test-output.log) - Allow? [Y/n] n
  Alternative: Allow read-only access? [Y/n] y
```

### セッション単位の権限保存

```bash
Background agent requires permissions:
- Bash (git fetch)
- Read (.git/*)

Allow these permissions? [y/N] y
Save for this session? [Y/n] y

✓ Permissions saved for this session
```

同じセッション内では再度確認されません。

## 注意点

- **セキュリティ強化**: 意図しない操作を防ぐため、起動前に確認が入ります
- **権限の範囲**: バックグラウンドエージェントは承認されたツールのみを使用できます
- **拒否の影響**: 必要な権限を拒否すると、タスクが正常に完了しない可能性があります
- **保存された権限**: プロジェクト設定で権限を事前に設定しておくことも可能です

## 権限の事前設定

頻繁に使用するバックグラウンドタスクの権限を `.claude/settings.json` に保存できます：

```json
{
  "permissions": {
    "allow": [
      "Bash(npm test)",
      "Bash(npm run build)",
      "Read(**/*.test.js)",
      "Write(test-results/**)"
    ]
  }
}
```

これにより、毎回の確認を省略できます。

## 関連情報

- [Claude Code 権限システム](https://code.claude.com/docs/en/permissions)
- [バックグラウンドタスク管理](https://code.claude.com/docs/en/background-tasks)
- [権限設定ガイド](https://www.eesel.ai/blog/claude-code-permissions)
