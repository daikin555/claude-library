---
title: "CLAUDE_CODE_SIMPLEがスキル・セッションメモリ・カスタムエージェント・CLAUDE.mdのトークンカウントを完全に除去するよう修正されました"
date: 2026-02-21
tags: [bug-fix, simple-mode, performance, configuration]
---

## 原文（日本語に翻訳）

`CLAUDE_CODE_SIMPLE` がスキル、セッションメモリ、カスタムエージェント、およびCLAUDE.mdのトークンカウントを完全に除去するよう修正されました。

## 原文（英語）

Fixed `CLAUDE_CODE_SIMPLE` to fully strip down skills, session memory, custom agents, and CLAUDE.md token counting

## 概要

`CLAUDE_CODE_SIMPLE` 環境変数を設定した際、スキル・セッションメモリ・カスタムエージェント定義・CLAUDE.mdのトークンカウント処理が完全には無効化されていなかった問題が修正されました。この修正により、シンプルモードでの動作がより軽量になり、意図通りの最小構成でClaudeが起動するようになります。

## 基本的な使い方

`CLAUDE_CODE_SIMPLE=1` 環境変数を設定してClaudeを起動することで、完全にストリップダウンされたシンプルモードで動作します。

```bash
# シンプルモードで起動
CLAUDE_CODE_SIMPLE=1 claude

# または環境変数として永続化
export CLAUDE_CODE_SIMPLE=1
claude
```

修正後のシンプルモードで無効化される要素：
- スキル（Skills）
- セッションメモリ
- カスタムエージェント定義
- CLAUDE.mdのトークンカウント
- MCPツール（v2.1.50で追加）
- 添付ファイル（v2.1.50で追加）
- フック（v2.1.50で追加）
- CLAUDE.mdファイルの読み込み（v2.1.50で追加）

## 実践例

### ユースケース1: CI/CDパイプラインでの最小構成実行

CI環境でClaudeを使用する場合、プロジェクト固有の設定を読み込まずに実行できます。

```bash
#!/bin/bash
# ci-script.sh

export CLAUDE_CODE_SIMPLE=1

# シンプルモードで実行（プロジェクトのCLAUDE.mdやスキルを無視）
claude -p "コードをレビューして問題があれば報告してください" \
  --no-interactive \
  --output-format json
```

### ユースケース2: デバッグ時の最小構成確認

問題の切り分けのために、カスタム設定なしでClaudeを実行する場合。

```bash
# 通常モードで問題が発生する場合
claude -p "テストを実行して"

# シンプルモードで同じ操作を試す（スキルやフックなしで動作確認）
CLAUDE_CODE_SIMPLE=1 claude -p "テストを実行して"

# 動作が異なる場合、問題はカスタムスキルやフックにある可能性が高い
```

### ユースケース3: トークン使用量の最小化

CLAUDE.mdや大きなスキル定義によるトークン消費を避けたい場合。

```bash
# 大きなCLAUDE.mdがあるプロジェクトで
wc -l CLAUDE.md
# 500行のCLAUDE.md

# シンプルモードではCLAUDE.mdが読み込まれないため
# トークン使用量を節約できる
CLAUDE_CODE_SIMPLE=1 claude -p "この関数の動作を説明して"
```

## 注意点

- `CLAUDE_CODE_SIMPLE=1` はすべてのカスタマイズを無効化します。プロジェクト固有の設定が必要な場合はシンプルモードを使用しないでください。
- この修正以前は、シンプルモードでもCLAUDE.mdのトークンカウント処理などが内部で行われていました。
- v2.1.50では同時に、MCPツール・添付ファイル・フック・CLAUDE.mdファイル読み込みもシンプルモードで無効化されるよう機能拡張されています。
- テスト環境や再現性が必要な環境でシンプルモードを活用することを推奨します。

## 関連情報

- [Claude Code 公式ドキュメント](https://docs.anthropic.com/ja/docs/claude-code/overview)
- [Claude Code CHANGELOG](https://github.com/anthropics/claude-code/blob/main/CHANGELOG.md)
- [CLAUDE_CODE_SIMPLE モードの機能拡張](./2.1.50-simple-mode-mcp-disable.md)
