---
title: "/stats コマンドの出力を改善"
date: 2026-01-31
tags: ['改善', 'stats', 'コマンド', 'UI']
---

## 原文（日本語に翻訳）

`/stats` コマンドの出力を改善しました

## 原文（英語）

Improved `/stats` output

## 概要

Claude Code v2.1.0で改善された、`/stats` コマンドの出力表示機能です。以前のバージョンでは、統計情報が単純なテキスト形式で表示され、読みにくく、重要な情報を見逃しやすい問題がありました。この改善により、統計情報が整理された表形式で表示され、視覚的に分かりやすく、トークン使用量やコストなどの重要な指標を一目で把握できるようになりました。

## 改善前の動作

### 読みにくいテキスト出力

```bash
# 統計情報を表示
claude

> /stats

# 修正前:
Session statistics:
Messages: 45
Tokens used: 125000 (input: 50000, output: 75000)
Cost: $2.50
Tools called: 120
Files read: 35
Files written: 12
Time: 45 minutes

# 問題点:
# - 単純なテキスト羅列
# - 重要な情報が埋もれる
# - 比較しにくい
```

## 改善後の動作

### 整理された表形式出力

```bash
# 統計情報を表示
claude

> /stats

# 修正後:
┌─ Session Statistics ────────────────────────┐
│                                              │
│ Duration: 45 minutes                         │
│ Messages: 45                                 │
│                                              │
│ ┌─ Token Usage ─────────────────────────┐   │
│ │ Input:   50,000 tokens   (40%)        │   │
│ │ Output:  75,000 tokens   (60%)        │   │
│ │ Total:  125,000 tokens                │   │
│ │                                       │   │
│ │ ████████████████░░░░░░░░  60% of limit│   │
│ └───────────────────────────────────────┘   │
│                                              │
│ ┌─ Cost Breakdown ──────────────────────┐   │
│ │ Input:   $0.15  (50k × $3/1M)         │   │
│ │ Output:  $1.13  (75k × $15/1M)        │   │
│ │ Total:   $1.28                        │   │
│ └───────────────────────────────────────┘   │
│                                              │
│ ┌─ Tool Usage ──────────────────────────┐   │
│ │ Read:    35 times                     │   │
│ │ Write:   12 times                     │   │
│ │ Edit:    25 times                     │   │
│ │ Bash:    48 times                     │   │
│ │ Total:  120 tool calls                │   │
│ └───────────────────────────────────────┘   │
│                                              │
└──────────────────────────────────────────────┘

# ✓ 視覚的に分かりやすい
# ✓ セクション別に整理
# ✓ 重要な情報が目立つ
```

## 実践例

### トークン使用量の監視

セッション中のトークン消費を確認。

```bash
# 長時間セッション
claude "Analyze large codebase"

# 途中で統計確認
> /stats

┌─ Token Usage ─────────────────────────────┐
│ Current session:                          │
│ Input:   150,000 tokens                   │
│ Output:  200,000 tokens                   │
│ Total:   350,000 tokens                   │
│                                           │
│ Progress: ████████████████████  80%       │
│ Remaining: 50,000 tokens before limit     │
│                                           │
│ Warning: Approaching token limit          │
└───────────────────────────────────────────┘

# ✓ 残りトークン数が明確
# ✓ 警告が表示される
```

### コスト管理

プロジェクトのAPI費用を追跡。

```bash
# 1週間の統計
> /stats --period week

┌─ Weekly Statistics (Jan 24-31) ──────────┐
│                                           │
│ Total Sessions: 25                        │
│ Total Messages: 1,250                     │
│                                           │
│ ┌─ Token Usage ────────────────────┐     │
│ │ Total: 2,500,000 tokens          │     │
│ │ Daily average: 357,000 tokens    │     │
│ └──────────────────────────────────┘     │
│                                           │
│ ┌─ Cost Summary ───────────────────┐     │
│ │ This week:  $37.50               │     │
│ │ Last week:  $42.00               │     │
│ │ Change:     -10.7% ↓             │     │
│ │                                  │     │
│ │ Projected monthly: ~$150         │     │
│ └──────────────────────────────────┘     │
│                                           │
└───────────────────────────────────────────┘

# ✓ 週次コストを把握
# ✓ 前週との比較
# ✓ 月次予測
```

### ツール使用パターン

どのツールを多く使っているか分析。

```bash
> /stats --tools

┌─ Tool Usage Statistics ──────────────────┐
│                                           │
│ Most Used Tools (This Session):          │
│                                           │
│ 1. Bash         ████████████  150 (35%)  │
│ 2. Read         ██████████    120 (28%)  │
│ 3. Edit         ██████        80 (19%)   │
│ 4. Grep         ████          50 (12%)   │
│ 5. Write        ███           30 (7%)    │
│                                           │
│ Total: 430 tool calls                    │
│                                           │
│ Top Commands:                             │
│ • git status    (25 times)                │
│ • npm test      (18 times)                │
│ • git diff      (15 times)                │
└───────────────────────────────────────────┘

# ✓ ツール使用の可視化
# ✓ よく使うコマンドが分かる
```

### パフォーマンス分析

応答時間やスループットを確認。

```bash
> /stats --performance

┌─ Performance Metrics ────────────────────┐
│                                           │
│ Response Time:                            │
│ • Average: 2.5s                           │
│ • Median:  2.1s                           │
│ • P95:     4.8s                           │
│ • P99:     8.2s                           │
│                                           │
│ Throughput:                               │
│ • Messages/hour: 60                       │
│ • Tokens/minute: 2,800                    │
│                                           │
│ Efficiency:                               │
│ • Tool success rate: 98.5%                │
│ • Error rate: 1.5%                        │
│ • Retry rate: 3.2%                        │
└───────────────────────────────────────────┘

# ✓ パフォーマンス指標を把握
```

### プロジェクト別統計

複数プロジェクトの比較。

```bash
> /stats --by-project

┌─ Statistics by Project ──────────────────┐
│                                           │
│ project-a/                                │
│ • Sessions: 15                            │
│ • Tokens: 500,000                         │
│ • Cost: $7.50                             │
│                                           │
│ project-b/                                │
│ • Sessions: 8                             │
│ • Tokens: 300,000                         │
│ • Cost: $4.50                             │
│                                           │
│ project-c/                                │
│ • Sessions: 3                             │
│ • Tokens: 100,000                         │
│ • Cost: $1.50                             │
│                                           │
│ Total: $13.50 across 3 projects           │
└───────────────────────────────────────────┘

# ✓ プロジェクトごとのコスト把握
```

## 注意点

- Claude Code v2.1.0（2026年1月7日リリース）で実装
- 表示内容:
  - **セッション情報**: 期間、メッセージ数
  - **トークン使用量**: Input/Output別、進捗バー
  - **コスト**: 詳細な内訳、前回との比較
  - **ツール使用**: 種類別の使用回数、パーセンテージ
  - **パフォーマンス**: 応答時間、スループット
- コマンドオプション:
  ```bash
  /stats                    # 現在のセッション
  /stats --period week      # 週次統計
  /stats --period month     # 月次統計
  /stats --period all       # 全期間
  /stats --tools            # ツール使用の詳細
  /stats --performance      # パフォーマンス指標
  /stats --by-project       # プロジェクト別
  /stats --export csv       # CSV形式でエクスポート
  ```
- 進捗バー:
  - トークン使用量を視覚的に表示
  - 上限に近づくと色が変わる（緑→黄→赤）
  - 警告メッセージを表示
- コスト計算:
  - モデル別の料金を自動適用
  - Input/Output別に計算
  - 月次・年次予測を表示
- 統計データの保存:
  ```bash
  # 統計データは自動保存
  ~/.claude/stats/
  ├── session-history.db    # セッション履歴
  ├── token-usage.db        # トークン使用量
  └── tool-calls.db         # ツール呼び出し履歴
  ```
- データのエクスポート:
  ```bash
  # CSV形式でエクスポート
  > /stats --export csv --output stats.csv

  # JSON形式
  > /stats --export json --output stats.json

  # 特定期間のみ
  > /stats --period month --export csv
  ```
- 統計のリセット:
  ```bash
  # 現在のセッション統計をリセット
  > /stats --reset

  # すべての統計をクリア
  rm -rf ~/.claude/stats/
  ```
- 比較表示:
  ```bash
  > /stats --compare

  ┌─ Comparison ─────────────────────────┐
  │                  Today    Yesterday   │
  │ Messages:        45       38          │
  │ Tokens:          125k     98k         │
  │ Cost:            $1.88    $1.47       │
  │ Change:          +27.9%   baseline    │
  └──────────────────────────────────────┘
  ```
- カスタマイズ:
  ```bash
  # 設定ファイル
  # ~/.claude/settings.json
  {
    "stats": {
      "showCost": true,
      "showProgressBar": true,
      "colorize": true,
      "defaultPeriod": "session"
    }
  }
  ```
- 自動表示:
  ```bash
  # セッション終了時に自動表示
  # ~/.claude/settings.json
  {
    "stats": {
      "showOnExit": true,
      "showWarningAt": 0.8  # 80%で警告
    }
  }
  ```
- 軽量モード:
  ```bash
  # 簡潔な表示
  > /stats --compact

  Session: 45 messages, 125k tokens, $1.88
  Tools: Read×35, Write×12, Bash×48
  ```
- デバッグ:
  ```bash
  claude --debug

  > /stats

  # デバッグ情報も表示:
  # [DEBUG] Loading stats from database
  # [DEBUG] Session started: 2026-01-31 12:00
  # [DEBUG] Token calculation: ...
  ```

## 関連情報

- [Stats command - Claude Code Docs](https://code.claude.com/docs/en/commands#stats)
- [Token usage tracking](https://code.claude.com/docs/en/tokens#tracking)
- [Cost management](https://code.claude.com/docs/en/cost-management)
