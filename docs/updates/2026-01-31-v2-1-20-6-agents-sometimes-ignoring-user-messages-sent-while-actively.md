---
title: "エージェント作業中のユーザーメッセージが無視される問題を修正"
date: 2026-01-27
tags: ['バグ修正', 'メッセージ処理', 'ユーザー体験']
---

## 原文（日本語に翻訳）

エージェントがアクティブに作業している最中に送信されたユーザーメッセージが、時折無視される問題を修正

## 原文（英語）

Fixed agents sometimes ignoring user messages sent while actively working on a task

## 概要

Claude Code v2.1.20では、エージェントが処理を実行している最中にユーザーが送信したメッセージが無視される問題が修正されました。以前は、エージェントが複数のツールを実行中やファイル編集中に新しい指示を送っても、それが処理されないことがありました。この修正により、作業中でもユーザーの割り込みや追加指示が確実に処理されるようになります。

## 基本的な使い方

修正により、エージェント作業中でもメッセージが確実に受信されます：

```bash
# エージェントが長い処理を実行中
claude
> プロジェクト全体のテストを実行して

# テスト実行中に追加指示を送信
> あ、その前にlintも実行して

# 修正前：このメッセージが無視されることがあった
# 修正後：メッセージが適切にキューイングされ、処理される
```

## 実践例

### 長時間実行タスクへの割り込み

大規模なリファクタリング中に方針変更が必要になった場合：

```bash
> src/ ディレクトリ内の全ファイルで古いAPIを新しいものに置き換えて

# エージェントが作業を開始...
# 10個のファイルを編集中...

> 待って、src/legacy/ ディレクトリは除外して

# 修正後の動作：
# - メッセージが即座に認識される
# - エージェントが現在のタスクを調整
# - legacy/ ディレクトリをスキップして作業継続
```

### テスト実行中の優先度変更

CI/CDパイプラインのような長時間タスク中：

```bash
> すべてのテストスイートを実行して、失敗したら修正して

# ユニットテストが実行中...

> 統合テストは後回しにして、まずユニットテストの結果を見せて

# 修正により：
# - 実行中でもメッセージが処理される
# - エージェントが優先順位を調整
# - ユーザーの意図に沿った実行順序に変更
```

### 複数ツール実行中の追加要求

ファイル検索や一括編集などの複数ツール使用時：

```bash
> プロジェクト内のすべての TODO コメントを見つけて、優先度順にリスト化して

# エージェントがファイルをスキャン中...

> FIXME コメントも含めて

# 以前の問題：
# - メッセージが処理されず、TODO のみが検索される
# - ユーザーが再度リクエストする必要があった

# 修正後：
# - FIXME も検索対象に追加される
# - シームレスに要求が反映される
```

### リアルタイムフィードバックの提供

エージェントの作業を監視しながらガイダンスを提供：

```bash
> この React コンポーネントをリファクタリングして、パフォーマンスを改善して

# エージェントが useState を useMemo に変更中...

> あと、useCallback も使ってコールバックをメモ化して

# 修正により：
# - 作業中でも追加のベストプラクティス提案が受け入れられる
# - より効果的なコラボレーションが可能に
```

## 注意点

- この修正は、エージェントとユーザーのインタラクションをより自然にします
- メッセージは送信順に処理されます
- 緊急の割り込みには `Ctrl+C` でタスクをキャンセルすることも可能です
- エージェントが応答するまで少し時間がかかる場合がありますが、メッセージは失われません
- 複数のメッセージを素早く送信すると、それらはキューに入れられ順番に処理されます

## 関連情報

- [Interactive Mode - Working with Claude](https://code.claude.com/docs/en/interactive-mode#working-with-claude)
- [Agent Behavior](https://code.claude.com/docs/en/advanced/agent-behavior)
- [Cancelling Operations](https://code.claude.com/docs/en/interactive-mode#cancelling-operations)
- [Changelog v2.1.20](https://github.com/anthropics/claude-code/releases/tag/v2.1.20)
