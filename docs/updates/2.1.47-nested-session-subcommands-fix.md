---
title: "ネストされたClaudeセッション内でのサブコマンド実行ブロック問題を修正"
date: 2026-02-19
tags: [bug-fix, subcommands, nested-session]
---

## 原文（日本語に翻訳）

ネストされたClaudeセッション内で `claude doctor` や `claude plugin validate` などの非インタラクティブなサブコマンドがブロックされていた問題を修正 (anthropics/claude-code#25803)

## 原文（英語）
Fixed non-interactive subcommands like `claude doctor` and `claude plugin validate` being blocked inside nested Claude sessions (anthropics/claude-code#25803)

## 概要

Claude Codeがエージェントとして別のClaudeセッションの内部から起動される「ネストされたセッション」において、`claude doctor` や `claude plugin validate` などの非インタラクティブなサブコマンドが実行をブロックされる問題が修正されました。この修正により、エージェントループ内からでも診断コマンドやプラグイン検証コマンドを正常に実行できるようになります。

## 基本的な使い方

```bash
# ネストされたセッション内でも以下のコマンドが正常に動作するようになった

# 診断コマンド
claude doctor

# プラグイン検証コマンド
claude plugin validate
```

## 実践例

### エージェントスクリプト内での診断実行

Claude Codeをサブエージェントとして使用するスクリプト内で、診断コマンドを活用できるようになりました。

```bash
#!/bin/bash
# メインのClaudeセッション内からサブエージェントを呼び出す例
# サブエージェント内でclaudeの診断を実行

claude -p "以下のコマンドを実行して結果を報告してください: claude doctor"
```

### プラグイン開発ワークフロー内での検証

プラグイン開発時に、自動化されたワークフロー内でプラグインの検証を行えるようになりました。

```bash
# CI/CDパイプラインやスクリプトからClaudeセッション経由でプラグインを検証
claude -p "プラグインのバリデーションを実行してください: claude plugin validate ./my-plugin"
```

### ネストされたセッションでのヘルスチェック

```bash
# 複数のサブエージェントを管理するオーケストレーターシナリオ
# 各エージェントが独立してclaudeの状態を確認できる
claude --dangerously-skip-permissions -p "claude doctorを実行してシステム状態を確認してください"
```

## 注意点

- この修正はv2.1.47以降で有効です
- ネストされたセッションとは、Claudeがサブエージェントとして別のClaudeプロセス内から実行される状態を指します
- `claude doctor` や `claude plugin validate` は非インタラクティブモードで実行されるため、ユーザー入力を必要としないサブコマンドのみがサポートされます
- インタラクティブなサブコマンド（TUIを表示するもの）はネストされたセッションでは引き続き制限される場合があります

## 関連情報

- [Claude Code 公式ドキュメント](https://docs.anthropic.com/ja/docs/claude-code/overview)
- [Claude Code CHANGELOG](https://github.com/anthropics/claude-code/blob/main/CHANGELOG.md)
- [Issue #25803](https://github.com/anthropics/claude-code/issues/25803)
