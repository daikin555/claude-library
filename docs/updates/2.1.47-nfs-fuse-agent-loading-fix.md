---
title: "NFS/FUSEファイルシステムでのユーザー定義エージェント読み込み修正"
date: 2026-02-19
tags: [bug-fix, agents, nfs, filesystem]
---

## 原文（日本語に翻訳）

inode をゼロとして報告する NFS/FUSE ファイルシステムで、ユーザー定義のエージェントが1ファイルしか読み込まれない問題を修正しました（anthropics/claude-code#26044）。

## 原文（英語）
Fixed user-defined agents only loading one file on NFS/FUSE filesystems that report zero inodes (anthropics/claude-code#26044)

## 概要

NFS（ネットワークファイルシステム）やFUSE（ユーザー空間ファイルシステム）など、inodeを0として報告するファイルシステム上でClaude Codeを使用する場合、ユーザー定義のエージェント設定ファイルが最初の1ファイルしか読み込まれない問題がありました。この修正により、NFS/FUSE環境でも全てのエージェント設定ファイルが正しく読み込まれるようになります。

## 基本的な使い方

```bash
# NFS/FUSE環境でのClaude Code使用
# マウントされたNFSディレクトリでプロジェクトを操作

# 修正前: .claude/agents/ 内の複数ファイルのうち1つしか読み込まれない
# 修正後: 全てのエージェント設定ファイルが正しく読み込まれる

ls .claude/agents/
# code-reviewer.md
# documentation-writer.md
# test-generator.md
# ↑ 修正後は全ての定義が有効になる
```

## 実践例

### ユースケース1: NFSマウントされたプロジェクトでの複数エージェント使用

```bash
# NFSでマウントされた共有プロジェクトディレクトリ
# /mnt/nfs/project/ に複数のエージェント定義がある場合

ls /mnt/nfs/project/.claude/agents/
# analyzer.md      ← エージェント定義1
# reviewer.md      ← エージェント定義2
# formatter.md     ← エージェント定義3

# 修正前: analyzer.md のみ読み込まれ、他は無視されていた
# 修正後: 全3つのエージェントが利用可能

claude
> /agent:reviewer このPRをレビューしてください
# ← 修正後は正常に動作する
```

### ユースケース2: Dockerボリュームマウント（FUSE）

```yaml
# docker-compose.yml
version: '3'
services:
  claude-code:
    image: node:20
    volumes:
      - ./project:/app  # FUSEマウント
    working_dir: /app
    command: claude
```

```bash
# FUSEボリューム上のプロジェクトで複数エージェントを定義しても
# 修正後は全てのエージェントが正しく読み込まれる
```

### ユースケース3: リモート開発環境でのエージェント活用

```bash
# SSH経由でリモートサーバーのNFSストレージを使用する場合
# チーム共有のエージェント定義リポジトリをNFSマウント

# /mnt/team-agents/ にチーム共有エージェント定義
# .claude/agents/ にシンボリックリンクまたは直接配置

# 修正後: チーム全員が定義した全エージェントが利用可能
claude
> /agent:code-review-specialist このファイルをレビューしてください
```

## 注意点

- この問題はinodeを0として報告するファイルシステムに特有の問題です
- 通常のローカルファイルシステム（ext4, APFS, NTFS等）では発生しない問題です
- NFSサーバーの設定やFUSEドライバーの種類によっては、inodeが0で報告される場合があります
- GitHub Issue #26044 で報告された問題の修正です
- バージョン2.1.47以降で修正が適用されます

## 関連情報

- [Claude Code エージェント設定](https://docs.anthropic.com/ja/docs/claude-code/sub-agents)
- [Claude Code 公式ドキュメント](https://docs.anthropic.com/ja/docs/claude-code/overview)
- [Claude Code CHANGELOG](https://github.com/anthropics/claude-code/blob/main/CHANGELOG.md)
- [GitHub Issue #26044](https://github.com/anthropics/claude-code/issues/26044)
