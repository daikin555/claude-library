---
title: "作業ディレクトリ削除時のシェルコマンドエラーメッセージを改善"
date: 2026-02-26
tags: [bug-fix, shell, error-message, working-directory, UX]
---

## 原文（日本語に翻訳）

作業ディレクトリが削除された際に、シェルコマンドが明確なエラーメッセージを表示しない問題を修正しました。

## 原文（英語）

Fixed shell commands not showing a clear error message when the working directory has been deleted

## 概要

Claudeがシェルコマンドを実行中に、作業ディレクトリ（カレントディレクトリ）が削除されている場合、以前は不明瞭なエラーメッセージしか表示されず、原因の特定が困難でした。今回の修正により、作業ディレクトリが削除されていることを明示的に示すエラーメッセージが表示されるようになり、問題の診断と対処がより迅速に行えるようになります。

## 基本的な使い方

### 問題が発生するシナリオ

```bash
# ディレクトリを作成して作業を開始
mkdir /tmp/workspace && cd /tmp/workspace
claude

# 別のプロセスや操作でディレクトリが削除された場合
# （例：別のターミナルでrm -rf /tmp/workspace を実行）

# Claudeが次のコマンドを実行しようとすると...
ls -la
# 改善前: 不明瞭なエラーメッセージ（原因が分かりにくい）
# 改善後: "作業ディレクトリが削除されました" などの明確なメッセージ
```

### エラーメッセージの確認と対処

```bash
# 作業ディレクトリが削除された場合のエラーメッセージを確認し、
# 別のディレクトリに移動して作業を継続

cd /home/user/projects  # 有効なディレクトリに移動
# → Claudeがそのディレクトリで作業を続行できる
```

## 実践例

### 一時ディレクトリでの作業

```bash
# 一時ディレクトリを使った作業では削除リスクがある
cd /tmp/build-workspace
claude

# ビルドスクリプトがディレクトリをクリーンアップする場合
# 以前: ランダムなシェルエラーで混乱
# 改善後: "作業ディレクトリが削除されました" と明示されるため
#         すぐに対処できる
```

### CI/CD環境での使用

```bash
# CI/CDジョブでのチェックアウトと処理
git clone https://github.com/example/repo.git /tmp/ci-build
cd /tmp/ci-build
claude --headless -p "コードを分析してください"

# CI環境でのディレクトリ操作が衝突した場合でも
# 明確なエラーで状況を把握できる
```

### Docker コンテナやボリューム操作での対処

```bash
# マウントされたボリュームが突然アンマウントされた場合など
# 作業ディレクトリが消失するケースで有効

# エラーメッセージで状況を把握したら：
cd /fallback/directory
# または、新しい安全なディレクトリを作成
mkdir -p /tmp/new-workspace && cd /tmp/new-workspace
```

## 注意点

- この修正はエラーメッセージの改善のみです。作業ディレクトリが削除された場合、Claudeは引き続き新しい有効なディレクトリに移動する必要があります
- エラーが発生した場合は、有効な作業ディレクトリに `cd` してから作業を再開してください
- 一時ディレクトリ（`/tmp` 以下など）で作業する際は、他のプロセスによる削除リスクに注意してください
- 重要な作業は、削除されないことが保証された恒久的なディレクトリで行うことを推奨します

## 関連情報

- [Claude Code 公式ドキュメント](https://docs.anthropic.com/en/docs/claude-code)
- [Claude Code CHANGELOG](https://github.com/anthropics/claude-code/blob/main/CHANGELOG.md)
