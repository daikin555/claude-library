---
title: "claude doctorがmiseとasdfでインストールされたClaudeをネイティブインストールと誤判定する問題を修正"
date: 2026-02-19
tags: [bug-fix, diagnostics, mise, asdf, installation]
---

## 原文（日本語に翻訳）

`claude doctor` が mise と asdf で管理されたインストールをネイティブインストールとして誤って分類する問題を修正しました（anthropics/claude-code#26033）。

## 原文（英語）
Fixed `claude doctor` misclassifying mise and asdf-managed installations as native installs (anthropics/claude-code#26033)

## 概要

`claude doctor` コマンドによる診断で、mise（旧rtx）やasdfでインストールされたClaude Codeがネイティブインストール（npmやbrewで直接インストール）として誤って判定されるバグが修正されました。正しいインストール方法の分類により、診断結果や推奨されるアップデート方法が正確になります。mise/asdfユーザーは正しいアップデートコマンドの案内を受けられるようになります。

## 基本的な使い方

```bash
# claude doctor コマンドでインストール状態を診断
claude doctor

# 修正前（mise/asdf使用時）:
# Installation type: native  ← 誤判定
# Update command: npm install -g @anthropic-ai/claude-code

# 修正後:
# Installation type: mise  ← 正しく判定
# Update command: mise upgrade claude-code
# または
# Installation type: asdf  ← 正しく判定
# Update command: asdf install claude-code latest
```

## 実践例

### ユースケース1: miseでインストールしたClaude Codeの診断

mise（多言語バージョンマネージャー）でClaude Codeを管理している場合。

```bash
# mise でインストール
mise install claude-code
mise use claude-code

# 診断実行
claude doctor

# 修正後の出力:
# Claude Code Doctor
# ==================
# Installation type:   mise       ← 正しく判定
# Claude version:      2.1.47
# Node.js version:     20.11.0
# mise version:        2024.x.x
#
# Recommended update method:
# $ mise upgrade claude-code       ← 正しいアップデートコマンド
#
# Status: All checks passed
```

### ユースケース2: asdfでインストールしたClaude Codeの診断

asdf（汎用バージョンマネージャー）でClaude Codeを管理している場合。

```bash
# asdf でインストール
asdf plugin add claude-code
asdf install claude-code latest
asdf global claude-code latest

# 診断実行
claude doctor

# 修正後の出力:
# Claude Code Doctor
# ==================
# Installation type:   asdf       ← 正しく判定
# Claude version:      2.1.47
# Node.js version:     20.11.0
# asdf version:        0.14.x
#
# Recommended update method:
# $ asdf install claude-code latest  ← 正しいアップデートコマンド
# $ asdf global claude-code latest
#
# Status: All checks passed
```

### ユースケース3: チーム環境でのインストール方法の統一確認

チーム全体でのClaude Codeインストール方法を確認・標準化する場合。

```bash
# 各開発者が claude doctor を実行して情報を収集
claude doctor --json > claude-doctor-report.json

# 修正後は正確なインストール方法が記録される
cat claude-doctor-report.json
# {
#   "installationType": "mise",  ← 修正前は "native" と誤判定されていた
#   "version": "2.1.47",
#   "nodeVersion": "20.11.0",
#   "status": "healthy"
# }

# チームの標準環境確認スクリプト
for member in alice bob charlie; do
  echo "=== $member ==="
  ssh $member "claude doctor"
done
```

## 注意点

- mise は旧称 rtx とも呼ばれるバージョン管理ツールです。どちらを使っていても正しく判定されます
- この修正は `claude doctor` の診断精度に関するものであり、Claude Code本体の動作には影響しません
- 正しいインストール方法の判定により、アップデート時に誤ったコマンドを使用するリスクが減ります
- mise/asdf以外のバージョンマネージャー（volta、nvmなど）での動作については、それぞれのツールの対応状況を確認してください

## 関連情報

- [Claude Code 公式ドキュメント](https://docs.anthropic.com/ja/docs/claude-code/overview)
- [CHANGELOG.md](https://github.com/anthropics/claude-code/blob/main/CHANGELOG.md)
- [GitHub Issue #26033](https://github.com/anthropics/claude-code/issues/26033)
- [mise 公式サイト](https://mise.jdx.dev/)
- [asdf 公式サイト](https://asdf-vm.com/)
- [Claude Code インストールガイド](https://docs.anthropic.com/ja/docs/claude-code/setup)
