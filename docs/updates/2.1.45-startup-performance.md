---
title: "セッション履歴の遅延読み込みによる起動パフォーマンスの改善"
date: 2026-02-17
tags: [performance, startup, session-history, improvement]
---

## 原文（日本語に翻訳）

統計キャッシュのためのセッション履歴の先行読み込みを削除することで、起動パフォーマンスを改善

## 原文（英語）

Improved startup performance by removing eager loading of session history for stats caching

## 概要

Claude Code 2.1.45 では、起動時に行われていたセッション履歴の先行読み込み（Eager Loading）が削除され、起動パフォーマンスが改善されました。以前は統計情報のキャッシュを作成するために起動時に全セッション履歴を読み込んでいましたが、この処理を遅延読み込み（必要なタイミングで読み込む）方式に変更しました。特にセッション履歴が多い場合に起動が高速化されます。

## 基本的な使い方

この改善は自動的に適用されます。Claude Code を 2.1.45 以上にアップデートするだけで、起動が高速になります。

```bash
# Claude Code をアップデート
npm update -g @anthropic-ai/claude-code

# 起動時間の確認
time claude --version
```

## 実践例

### 起動時間の計測と比較

アップデート前後の起動時間を比較する方法：

```bash
# アップデート前（2.1.44）の起動時間を計測
time claude --version

# アップデート後（2.1.45）の起動時間を計測
npm update -g @anthropic-ai/claude-code
time claude --version

# より詳細な計測（Linux/macOS）
/usr/bin/time -v claude --version 2>&1 | grep "Maximum resident"
```

### セッション履歴が多い環境での効果

長期間 Claude Code を使用しており、セッション履歴が多く蓄積している場合に特に効果が大きいです：

```bash
# セッション履歴のサイズを確認
du -sh ~/.claude/projects/ 2>/dev/null
ls ~/.claude/projects/ 2>/dev/null | wc -l  # プロジェクト数

# 多数のセッション履歴がある場合、起動が特に高速化されます
```

### CI/CD 環境でのメリット

自動化スクリプトや CI/CD 環境で Claude Code を使う場合も、起動オーバーヘッドが削減されます：

```bash
#!/bin/bash
# CI スクリプト例: 起動時間の短縮により、繰り返し実行が高速化

for file in src/*.ts; do
  # 毎回起動するケースでも、起動オーバーヘッドが小さくなる
  claude -p "このファイルのコードをレビューしてください: $file" --output-format json
done
```

## 注意点

- この改善は特に「セッション履歴が多い（長期間使用している）ユーザー」に効果が大きいです。
- 初めて Claude Code を使うユーザーや履歴が少ない場合は、体感できる変化は小さいかもしれません。
- 統計情報（使用状況など）は引き続き収集されますが、読み込みのタイミングが変わっただけで、機能的な変化はありません。
- セッション履歴のデータ自体は削除されません。

## 関連情報

- [Claude Code パフォーマンス最適化](https://docs.anthropic.com/ja/docs/claude-code)
- [Claude Code セッション管理](https://docs.anthropic.com/ja/docs/claude-code/session-management)
