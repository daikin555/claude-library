---
title: "設定ファイルバックアップのタイムスタンプとローテーション"
date: 2026-01-27
tags: [change, config, backup, data-protection]
---

## 原文（日本語訳）
設定ファイルのバックアップにタイムスタンプを付け、ローテーション（最新5件を保持）するよう変更し、データ損失を防ぐようにしました

## 原文（英語）
Changed config backups to be timestamped and rotated (keeping 5 most recent) to prevent data loss

## 概要
設定ファイルのバックアップシステムが改善され、タイムスタンプ付きで最新5件のバックアップが自動的に保持されるようになりました。これにより、誤った設定変更からの復旧が容易になります。

## 基本的な使い方

バックアップは自動的に作成されます。特別な操作は不要です。

## バックアップファイルの場所

```bash
~/.claude/backups/
├── settings.json.backup.2026-01-27T10-30-45.json
├── settings.json.backup.2026-01-27T09-15-22.json
├── settings.json.backup.2026-01-26T14-20-10.json
├── settings.json.backup.2026-01-26T11-05-33.json
└── settings.json.backup.2026-01-25T16-45-19.json
```

最新5件が保持され、古いものは自動的に削除されます。

## 実践例

### 誤った設定の復元

設定を誤って変更した場合：

```bash
# 現在の設定を確認
cat ~/.claude/settings.json

# バックアップを確認
ls -lt ~/.claude/backups/settings.json.backup.*

# 正しいバックアップを復元
cp ~/.claude/backups/settings.json.backup.2026-01-27T09-15-22.json \
   ~/.claude/settings.json
```

### バックアップの時系列確認

```bash
# タイムスタンプ順にバックアップを表示
ls -lt ~/.claude/backups/

# 各バックアップの内容を比較
diff ~/.claude/backups/settings.json.backup.2026-01-27T10-30-45.json \
     ~/.claude/backups/settings.json.backup.2026-01-27T09-15-22.json
```

### 特定の設定変更の追跡

```bash
# 過去5回の権限設定の変更を確認
for backup in ~/.claude/backups/settings.json.backup.*.json; do
  echo "=== $backup ==="
  jq '.permissions' "$backup"
done
```

### Claude に依頼して復元

```bash
claude
> 2時間前の設定バックアップを復元してください
```

Claude が適切なバックアップファイルを見つけて復元します。

## 実践例：チーム開発での活用

### 実験的な設定変更

```bash
# 現在の設定が自動的にバックアップされる
claude
> /config

# 実験的な設定を試す（自動バックアップ作成）
```

問題があれば、すぐに戻せます：

```bash
# 1つ前の設定に戻す
cp ~/.claude/backups/settings.json.backup.2026-01-27T09-15-22.json \
   ~/.claude/settings.json
```

### バックアップからの学習

過去の設定を参照して、効果的な設定を学ぶ：

```bash
# 最も安定していた時期の設定を確認
cat ~/.claude/backups/settings.json.backup.2026-01-20T14-30-00.json
```

## 注意点

- **自動ローテーション**: 6件目以降のバックアップは自動的に削除されます
- **タイムスタンプ形式**: ISO 8601 形式（コロンは `-` に置き換え）で保存されます
- **重要な設定の保護**: 5件以上遡って復元したい場合は、手動でバックアップをコピーしておいてください
- **ディスク容量**: バックアップは軽量ですが、定期的にチェックすることを推奨します

## 長期保存が必要な場合

重要な設定の長期保存：

```bash
# 重要な設定を別の場所に保存
mkdir -p ~/.claude/important-backups
cp ~/.claude/settings.json \
   ~/.claude/important-backups/settings-stable-2026-01-27.json
```

または、Git で管理：

```bash
cd ~/.claude
git init
git add settings.json
git commit -m "Stable configuration 2026-01-27"
```

## バックアップの確認スクリプト

便利なヘルパースクリプト：

```bash
#!/bin/bash
# show-config-backups.sh

echo "Available config backups:"
ls -lth ~/.claude/backups/settings.json.backup.* | head -5

echo -e "\nTo restore a backup, run:"
echo "cp <backup-file> ~/.claude/settings.json"
```

## 関連情報

- [Claude Code 設定ガイド](https://code.claude.com/docs/en/configuration)
- [設定ファイルリファレンス](https://code.claude.com/docs/en/settings)
- [トラブルシューティング](https://code.claude.com/docs/en/troubleshooting)
