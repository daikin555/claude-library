---
title: "/resumeで最初のメッセージが16KBを超えるセッションが無言でスキップされる問題を修正"
date: 2026-02-19
tags: [bug-fix, session, resume, memory]
---

## 原文（日本語に翻訳）

最初のメッセージが16KBを超えるか配列形式のコンテンツを使用している場合に、`/resume` がセッションを無言でスキップする問題を修正しました（anthropics/claude-code#25721）。

## 原文（英語）
Fixed /resume silently dropping sessions when the first message exceeds 16KB or uses array-format content (anthropics/claude-code#25721)

## 概要

`/resume` コマンドでセッションを再開しようとした際、セッションの最初のメッセージが16KBを超えるか配列形式のコンテンツを含む場合に、エラーメッセージなしにそのセッションが一覧から除外されるバグが修正されました。ユーザーは存在するはずのセッションが見つからず混乱していました。修正後は大きなメッセージを持つセッションも正しく `resume` の候補として表示されます。

## 基本的な使い方

```bash
# 大きなコンテキストを持つセッションの再開
# 例: 最初のメッセージに大きなコードベースを貼り付けた場合

claude
> [16KB以上の大量のコードやテキストを貼り付けてセッション開始]
# ... 作業 ...

# 後日、セッションを再開
claude --resume
# 修正前: このセッションが一覧に表示されない（無言でスキップ）
# 修正後: 正しく一覧に表示され、再開できる
```

## 実践例

### ユースケース1: 大規模なコードレビューセッションの再開

大きなコードファイルをコンテキストとして最初に送ったセッションを再開する場合。

```bash
# 最初のメッセージで大量のコードを提供してセッション開始
claude
> 以下のコードをレビューしてください:
> [数千行のコードを貼り付け → 16KB超]

# レビューを途中で中断
# Ctrl+C でセッションを終了

# 後でセッションを再開
claude --resume
# 修正後: 大きなメッセージを含むセッションも表示される
# セッション一覧:
# 1. コードレビュー作業 (2時間前)  ← 表示される
# 2. 別のセッション (昨日)
```

### ユースケース2: 画像や複数メディアを含むセッションの再開

配列形式のコンテンツ（複数の画像やファイル）を含むセッションを再開する場合。

```bash
# 複数のスクリーンショットや図を含む最初のメッセージ
claude
> [複数の画像ファイルを添付して質問]
# 配列形式のコンテンツが作成される

# セッション終了後に再開
claude --resume
# 修正前: 配列形式のコンテンツを持つセッションがスキップされる
# 修正後: 正しく再開候補として表示される
```

### ユースケース3: 長い仕様書やドキュメントを含むセッションの再開

最初のメッセージに長い仕様書を貼り付けてタスクを開始したセッションを再開する場合。

```bash
# プロジェクト仕様書全体を最初のメッセージに含めてセッション開始
claude
> 以下の仕様書に基づいて実装を進めてください:
> [20,000文字以上の仕様書テキスト → 16KB超]

# セッションを一時停止して翌日再開
claude --resume

# 修正後の表示:
# セッション選択:
# 1. [仕様書名]に基づく実装 (昨日 14:30)  ← 正しく表示される
# > 1 を選択して再開
```

## 注意点

- 16KBの制限はセッションの「最初のメッセージ」に特有の問題でした。途中のメッセージが大きい場合は従来から問題なく動作していました
- 修正前に作成されたセッションも、v2.1.47以降では正しく `/resume` の候補として表示されます
- セッションデータ自体は保存されていたため、データが失われたわけではありませんでした
- 大きなコンテキストを持つセッションの再開は、通常のセッションより若干時間がかかる場合があります

## 関連情報

- [Claude Code 公式ドキュメント](https://docs.anthropic.com/ja/docs/claude-code/overview)
- [CHANGELOG.md](https://github.com/anthropics/claude-code/blob/main/CHANGELOG.md)
- [GitHub Issue #25721](https://github.com/anthropics/claude-code/issues/25721)
- [セッション管理とメモリガイド](https://docs.anthropic.com/ja/docs/claude-code/memory)
