---
title: "/context などのコマンドでの重複出力修正"
date: 2026-01-27
tags: [bugfix, command, output, context]
---

## 原文（日本語訳）
`/context` などの一部のコマンドで重複した出力が表示される問題が修正されました

## 原文（英語）
Fixed duplicate output in some commands like `/context`

## 概要
`/context` コマンドなど、一部のスラッシュコマンドで出力が重複して表示されてしまう問題が修正されました。より見やすく、正確な情報表示が可能になります。

## 問題の背景

### 修正前の問題
- `/context` や他の一部のコマンドで、同じ情報が2回表示された
- 出力が冗長で、重要な情報が見つけにくかった
- トークン数やファイル情報が重複してカウントされる場合があった

### 修正後
- 各情報が1回のみ表示される
- クリーンで読みやすい出力
- 正確な統計情報

## 基本的な使い方

通常通りコマンドを使用するだけで、改善された出力を確認できます。

```bash
claude
> /context
# ✅ 重複なしのクリーンな出力
```

## 実践例

### /context コマンドの出力

```bash
claude
> /context

# 修正前（重複あり）:
"""
Context Usage:
  Total tokens: 5,432 / 200,000 (2.7%)
  Total tokens: 5,432 / 200,000 (2.7%)  ← 重複

Files:
  - src/app.ts (234 tokens)
  - src/app.ts (234 tokens)  ← 重複

Skills:
  - /deploy (123 tokens)
  - /deploy (123 tokens)  ← 重複
"""

# 修正後（重複なし）:
"""
Context Usage:
  Total tokens: 5,432 / 200,000 (2.7%)

Files:
  - src/app.ts (234 tokens)
  - src/utils.ts (189 tokens)

Skills:
  - /deploy (123 tokens)
  - /test (98 tokens)
"""
```

### コンテキストの詳細表示

```bash
claude
> /context

# クリーンな出力:
"""
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Context Window Usage
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Total: 12,345 / 200,000 tokens (6.2%)
Remaining: 187,655 tokens (93.8%)

Breakdown:
├── System Prompt       1,234 tokens (10%)
├── Memory (CLAUDE.md)    456 tokens (4%)
├── Files (@-mentioned) 5,678 tokens (46%)
├── Skills              1,234 tokens (10%)
├── Conversation        3,743 tokens (30%)
└── Reserved            1,000 tokens (8%)

✅ 各項目が1回のみ表示される
"""
```

### トークン数の正確な表示

```bash
claude
> /context

# 修正前: トークン数が重複カウントされる可能性
# Total: 10,000 tokens (実際は 5,000 の重複)

# 修正後: 正確なトークン数
# Total: 5,000 tokens ✅
```

## 影響を受けるコマンド

### /context
```bash
> /context
# コンテキストウィンドウの使用状況を表示
# ✅ 重複なし
```

### その他の情報表示コマンド

一部の他のコマンドでも同様の修正が適用されています：

```bash
# ステータス表示
> /status

# 統計情報
> /stats

# 使用状況
> /usage
```

## コンテキスト管理の改善

### コンテキストの可視化

```bash
claude
> /context

# ファイルごとの内訳:
"""
Files (5,678 tokens):
  src/
  ├── app.ts          1,234 tokens
  ├── utils.ts          567 tokens
  ├── config.ts         234 tokens
  └── types.ts          123 tokens

  tests/
  └── app.test.ts     3,520 tokens
"""
# ✅ 各ファイルが1回のみ表示
```

### スキルの表示

```bash
claude
> /context

# スキル一覧:
"""
Skills (1,234 tokens):
  User Skills:
  ├── /deploy         456 tokens
  └── /test           234 tokens

  Project Skills:
  └── /build          544 tokens
"""
# ✅ 各スキルが1回のみ表示
```

### エージェントの表示

```bash
claude
> /context

# カスタムエージェント:
"""
Agents (789 tokens):
  ├── Review Agent    345 tokens
  └── Test Agent      444 tokens
"""
# ✅ 各エージェントが1回のみ表示
```

## verbose モードでの出力

```bash
# 詳細モード
claude --verbose
> /context

# より詳細な情報が表示されるが、重複なし
"""
Context Details (Verbose):

System Prompt:
  - Base system prompt: 1,000 tokens
  - Custom additions: 234 tokens
  Total: 1,234 tokens

Memory:
  - CLAUDE.md: 456 tokens
  - .claude/rules/*.md: 0 tokens
  Total: 456 tokens

...（各セクションが正確に1回表示）
"""
```

## コンテキスト管理のベストプラクティス

### 定期的な確認

```bash
# 作業中に定期的にコンテキストを確認
claude
> コード実装...
> /context  # 使用量チェック
> さらに実装...
> /context  # 再度チェック
# ✅ 正確な情報で管理できる
```

### 圧縮のタイミング

```bash
claude
> /context
# Total: 160,000 / 200,000 tokens (80%)
# → 圧縮を検討

> /compact
# 会話を圧縮

> /context
# Total: 15,000 / 200,000 tokens (7.5%)
# ✅ コンテキストがリセットされた
```

## 注意点

- **リアルタイム更新**: `/context` の情報はコマンド実行時点のスナップショットです
- **概算値**: トークン数は概算であり、実際の API 使用量と若干異なる場合があります
- **キャッシュ**: プロンプトキャッシュは別途計算されます

## トラブルシューティング

### 出力が重複して見える場合

```bash
# 1. 最新版を使用しているか確認
claude --version

# 2. セッションを再起動
# Ctrl+C で終了して再度起動
claude

# 3. /context を再実行
> /context
```

### トークン数が正しくない場合

```bash
# verbose モードで詳細を確認
claude --verbose
> /context

# または /doctor で診断
> /doctor
```

## 関連コマンド

### コンテキスト管理
```bash
> /context   # コンテキスト確認
> /compact   # 会話圧縮
> /clear     # 会話クリア
```

### 統計情報
```bash
> /usage     # 使用量確認
> /stats     # 統計情報
> /cost      # コスト確認
```

### システム情報
```bash
> /status    # ステータス確認
> /doctor    # 診断
> /help      # ヘルプ
```

## 関連情報

- [Claude Code Context Management](https://code.claude.com/docs/en/how-claude-code-works)
- [Claude Code /context Command](https://www.gradually.ai/en/claude-code-commands/)
- [Claude Code Changelog](https://claudefa.st/blog/guide/changelog)
