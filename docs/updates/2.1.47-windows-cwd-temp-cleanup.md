---
title: "WindowsでのCWD追跡一時ファイルが蓄積し続けるバグ修正"
date: 2026-02-19
tags: [bug-fix, windows, temp-files, cleanup]
---

## 原文（日本語に翻訳）

Windows: CWD（カレントワーキングディレクトリ）追跡の一時ファイルが無限に蓄積し続ける問題を修正しました（anthropics/claude-code#17600）。

## 原文（英語）
Windows: Fixed CWD tracking temp files never being cleaned up, causing them to accumulate indefinitely (anthropics/claude-code#17600)

## 概要

WindowsでClaude Codeを使用する際、カレントワーキングディレクトリ（CWD）の追跡に使用される一時ファイルがクリーンアップされずに無限に蓄積し続ける問題がありました。長期間Claude Codeを使用しているWindowsユーザーのシステムでは、ディスクスペースが徐々に消費される原因となっていました。この修正により、一時ファイルが適切に削除されるようになります。

## 基本的な使い方

```powershell
# 修正前: Claude Codeを使用するたびに一時ファイルが蓄積
# 修正後: 一時ファイルが適切にクリーンアップされる

# 一時ファイルの保存場所（参考）
# %TEMP%\claude-code-cwd-* など

# 修正前の問題確認（修正前の環境で多数のファイルが存在）
Get-ChildItem $env:TEMP -Filter "claude-code-*" | Measure-Object
# Count: 数百〜数千のファイルが蓄積していた

# 修正後: ファイルが適切に削除される
```

## 実践例

### ユースケース1: 長期使用後のディスクスペース回復

```powershell
# バージョン2.1.47へのアップデート後
# 既存の蓄積した一時ファイルを手動でクリーンアップ

# 蓄積したClaude Code一時ファイルを確認
$tempFiles = Get-ChildItem $env:TEMP -Filter "claude-code-cwd-*"
Write-Host "蓄積したファイル数: $($tempFiles.Count)"

# 必要に応じて手動でクリーンアップ
# $tempFiles | Remove-Item -Force
```

### ユースケース2: 企業環境での複数ユーザー使用

```powershell
# 複数のユーザーが同じWindowsマシンでClaude Codeを使用する場合
# 修正前: 各ユーザーのTEMPフォルダにファイルが蓄積

# ユーザープロファイルごとのTEMPフォルダ
# C:\Users\user1\AppData\Local\Temp\
# C:\Users\user2\AppData\Local\Temp\
# 修正後: 各ユーザーのTEMPフォルダが適切に管理される
```

### ユースケース3: ディスクスペース監視スクリプト

```powershell
# 修正前の環境でのディスク使用量監視スクリプト例
# (修正後は不要になるが、移行期間の参考として)

function Check-ClaudeCodeTempFiles {
    $tempPath = $env:TEMP
    $pattern = "claude-code-*"
    $files = Get-ChildItem $tempPath -Filter $pattern -ErrorAction SilentlyContinue

    if ($files.Count -gt 100) {
        Write-Warning "Claude Code一時ファイルが多数蓄積: $($files.Count)件"
        Write-Warning "v2.1.47以降にアップデートしてください"
    }
}

Check-ClaudeCodeTempFiles
```

## 注意点

- この修正はWindowsに特有の問題です。macOS/Linuxには影響しません
- バージョン2.1.47にアップデートすることで、新たな一時ファイルの蓄積が防止されます
- アップデート後も既存の蓄積したファイルは自動削除されない場合があります。手動でのクリーンアップが推奨されます
- 一時ファイルの蓄積によりディスクスペースが不足している場合は、まず手動でクリーンアップを実施してください
- GitHub Issue #17600 で長期間報告されていた問題の修正です

## 関連情報

- [Claude Code 公式ドキュメント](https://docs.anthropic.com/ja/docs/claude-code/overview)
- [Claude Code CHANGELOG](https://github.com/anthropics/claude-code/blob/main/CHANGELOG.md)
- [GitHub Issue #17600](https://github.com/anthropics/claude-code/issues/17600)
- [Windows での Claude Code セットアップ](https://docs.anthropic.com/ja/docs/claude-code/setup)
