---
title: "Bedrock・Vertex・Foundry での Agent Teams チームメンバー失敗の修正"
date: 2026-02-17
tags: [bugfix, agent-teams, bedrock, vertex, foundry, aws, gcp]
---

## 原文（日本語に翻訳）

API プロバイダーの環境変数を tmux によって生成されたプロセスに伝搬することで、Bedrock・Vertex・Foundry での Agent Teams のチームメンバーが失敗する問題を修正（anthropics/claude-code#23561）

## 原文（英語）

Fixed Agent Teams teammates failing on Bedrock, Vertex, and Foundry by propagating API provider environment variables to tmux-spawned processes (anthropics/claude-code#23561)

## 概要

Agent Teams（エージェントチーム）機能において、AWS Bedrock・Google Cloud Vertex AI・Azure Foundry などのクラウドプロバイダー経由で Claude を利用している場合に、チームメンバーエージェントが起動に失敗するバグが修正されました。原因は、tmux で生成されたサブプロセスに API プロバイダーの認証情報などの環境変数が引き継がれていなかったことです。この修正により、クラウドプロバイダー経由での Agent Teams が正常に動作するようになります。

## 基本的な使い方

この修正はバグフィックスのため、特別な操作は不要です。Claude Code を 2.1.45 以上にアップデートすることで自動的に適用されます。

```bash
# Claude Code をアップデート
npm update -g @anthropic-ai/claude-code

# バージョン確認
claude --version
```

## 実践例

### AWS Bedrock で Agent Teams を使う

AWS Bedrock 経由で Agent Teams を利用する場合、以下の環境変数が正しく設定されている必要があります：

```bash
# AWS 認証情報を設定
export AWS_ACCESS_KEY_ID="your-access-key"
export AWS_SECRET_ACCESS_KEY="your-secret-key"
export AWS_DEFAULT_REGION="us-east-1"
export ANTHROPIC_API_KEY=""  # Bedrock 使用時は空に

# Bedrock エンドポイントを指定
export CLAUDE_CODE_USE_BEDROCK=1

# Agent Teams を含む Claude Code を起動
claude
```

修正前は tmux で生成されたチームメンバープロセスにこれらの環境変数が伝搬されず、チームメンバーが失敗していました。2.1.45 ではこれが修正されています。

### Google Cloud Vertex AI で Agent Teams を使う

```bash
# GCP 認証情報を設定
export GOOGLE_APPLICATION_CREDENTIALS="/path/to/service-account.json"
export ANTHROPIC_VERTEX_PROJECT_ID="your-project-id"
export CLOUD_ML_REGION="us-central1"
export CLAUDE_CODE_USE_VERTEX=1

claude
```

### Azure Foundry で Agent Teams を使う

```bash
# Azure 設定
export AZURE_OPENAI_ENDPOINT="https://your-resource.openai.azure.com/"
export AZURE_API_KEY="your-azure-api-key"
export CLAUDE_CODE_USE_AZURE=1

claude
```

## 注意点

- この修正は Claude Code 2.1.45 以降で有効です。古いバージョンではこのバグが残っています。
- クラウドプロバイダー経由で使用する場合、環境変数の設定が正しくなければなりません（この修正はその伝搬の問題を解決するものです）。
- tmux がインストールされていない環境では Agent Teams は動作しません。
- ローカルの Anthropic API（`api.anthropic.com`）を直接使用する場合はこの問題の影響を受けません。

## 関連情報

- [GitHub Issue #23561](https://github.com/anthropics/claude-code/issues/23561)
- [Claude Code Agent Teams ドキュメント](https://docs.anthropic.com/ja/docs/claude-code/agent-teams)
- [AWS Bedrock での Claude Code 設定](https://docs.anthropic.com/ja/docs/claude-code/bedrock)
- [Google Vertex AI での Claude Code 設定](https://docs.anthropic.com/ja/docs/claude-code/vertex)
