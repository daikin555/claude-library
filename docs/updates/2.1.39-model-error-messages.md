---
title: "Bedrock/Vertex/Foundryユーザー向けモデルエラーメッセージの改善"
date: 2026-02-11
tags: [エラーハンドリング, AWS Bedrock, Google Vertex AI, Foundry, UX改善]
---

## 原文（日本語訳）

Bedrock/Vertex/Foundryユーザー向けに、フォールバック提案を含むモデルエラーメッセージを改善しました。

## 原文（英語）

Improved model error messages for Bedrock/Vertex/Foundry users with fallback suggestions

## 概要

Claude Code 2.1.39では、AWS Bedrock、Google Vertex AI、Foundryを使用するユーザーがモデルエラーに遭遇した際、より分かりやすいエラーメッセージと具体的なフォールバック提案が表示されるようになりました。これにより、問題の原因を素早く特定し、適切な対処を行えるようになりました。

## 主な改善点

### エラーメッセージの明確化

以前は曖昧だったエラーメッセージが、具体的な問題点と解決策を示すようになりました。

### フォールバック提案

使用できないモデルが指定された場合、代替モデルの提案が自動的に表示されます。

## 実践例

### AWS Bedrockでのモデルエラー

```bash
# 利用できないモデルを指定した場合
export CLAUDE_CODE_MODEL=claude-opus-4.6
export CLAUDE_CODE_PROVIDER=bedrock
claude

# 修正前のエラー
# Error: Model not available

# 修正後のエラー
# Error: Model 'claude-opus-4.6' is not available in your AWS Bedrock region (us-east-1)
#
# Available alternatives:
#   - claude-sonnet-4-5 (recommended for most tasks)
#   - claude-haiku-4 (faster, lower cost)
#
# To use a different model, set:
#   export CLAUDE_CODE_MODEL=claude-sonnet-4-5
```

### Google Vertex AIでのリージョン制限

```bash
# リージョン制限のあるモデルを使用
export CLAUDE_CODE_PROVIDER=vertex
export GOOGLE_CLOUD_REGION=asia-northeast1
claude

# 改善されたエラーメッセージ
# Error: Model 'claude-opus-4.6' is not available in region 'asia-northeast1'
#
# This model is available in:
#   - us-central1
#   - europe-west4
#
# Or use these models available in your region:
#   - claude-sonnet-4-5
#   - claude-haiku-4
#
# To change region:
#   export GOOGLE_CLOUD_REGION=us-central1
```

### Foundryでの権限エラー

```bash
# アクセス権限のないモデルを使用
export CLAUDE_CODE_PROVIDER=foundry
claude

# 詳細なエラーメッセージ
# Error: Access denied to model 'claude-opus-4.6'
#
# Your organization plan may not include this model.
# Contact your Foundry administrator to:
#   1. Verify model access permissions
#   2. Request access to Claude Opus 4.6
#
# Models available to you:
#   - claude-sonnet-4-5
#   - claude-haiku-4
#
# Tip: Use 'claude models list' to see all accessible models
```

### モデルバージョンの互換性

```bash
# 古いバージョンのモデルIDを使用
export CLAUDE_CODE_MODEL=claude-3-opus
claude

# バージョン移行の提案
# Warning: Model 'claude-3-opus' is deprecated
#
# Recommended migration:
#   claude-3-opus → claude-opus-4.6
#
# The new model offers:
#   - Better performance
#   - Extended context window
#   - Improved reasoning capabilities
#
# Update with:
#   export CLAUDE_CODE_MODEL=claude-opus-4.6
```

### 設定ファイルでのエラー対応

```json
// ~/.claude/settings.json
{
  "provider": "bedrock",
  "model": "invalid-model-name"
}
```

```bash
claude

# 設定ファイルのエラーも詳細に説明
# Error: Invalid model configuration in ~/.claude/settings.json
#
# Issue: Model 'invalid-model-name' does not exist
#
# Did you mean:
#   - claude-sonnet-4-5
#   - claude-opus-4.6
#
# Edit your settings.json:
#   {
#     "provider": "bedrock",
#     "model": "claude-sonnet-4-5"
#   }
```

## エラータイプ別の対処法

### モデル未対応エラー

```bash
# プロバイダーで対応していないモデル
# → フォールバック提案に従って対応モデルに切り替え
export CLAUDE_CODE_MODEL=claude-sonnet-4-5
```

### リージョンエラー

```bash
# 利用可能なリージョンに変更
export GOOGLE_CLOUD_REGION=us-central1
# または
export AWS_REGION=us-east-1
```

### 権限エラー

```bash
# アクセス可能なモデルを確認
claude models list

# 利用可能なモデルに切り替え
export CLAUDE_CODE_MODEL=claude-haiku-4
```

## 注意点

- **プロバイダー別の違い**: 各クラウドプロバイダーで利用可能なモデルとリージョンが異なります
- **コスト考慮**: フォールバックモデルの料金体系を確認してから使用してください
- **パフォーマンス**: 推奨される代替モデルは、元のモデルと同等以上の性能を提供するよう選択されています
- **設定の永続化**: 環境変数での設定は一時的です。恒久的に変更する場合は`~/.claude/settings.json`を編集してください

## トラブルシューティング

### 利用可能なモデルの確認

```bash
# 現在のプロバイダーで利用できるモデル一覧
claude models list --provider bedrock
claude models list --provider vertex
claude models list --provider foundry
```

### 現在の設定確認

```bash
# 現在の設定を確認
claude config show

# 出力例:
# Provider: bedrock
# Model: claude-sonnet-4-5
# Region: us-east-1
```

### 設定のリセット

```bash
# デフォルト設定に戻す
claude config reset

# 特定の設定のみリセット
claude config reset model
```

## 関連情報

- [Claude Code モデル選択ガイド](https://code.claude.com/docs/en/)
- [AWS Bedrock 対応モデル](https://aws.amazon.com/bedrock/)
- [Google Vertex AI 対応モデル](https://cloud.google.com/vertex-ai)
- [Claude Code 設定ドキュメント](https://code.claude.com/docs/en/monitoring-usage)
