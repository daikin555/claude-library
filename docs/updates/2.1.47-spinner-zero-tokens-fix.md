---
title: "トークン受信前にスピナーが「0トークン」を表示する問題を修正"
date: 2026-02-19
tags: [bug-fix, ui, spinner, tokens]
---

## 原文（日本語に翻訳）

トークンを受信する前にスピナーが「0トークン」カウンターを表示していた問題を修正 (anthropics/claude-code#26105)

## 原文（英語）
Fixed spinner showing "0 tokens" counter before any tokens have been received (anthropics/claude-code#26105)

## 概要

Claude Codeの処理中に表示されるスピナー（ローディングアニメーション）が、APIからトークンを受信する前の段階から「0 tokens」というカウンターを表示してしまっていました。この修正により、実際にトークンが受信されるまでトークンカウンターは表示されなくなり、UIがより直感的になります。

## 基本的な使い方

```bash
# 修正前: Claudeへの入力送信直後から "0 tokens" が表示されていた
# [Thinking... 0 tokens]

# 修正後: トークンを受信し始めてからカウンターが表示される
# [Thinking...]  ← トークン受信前
# [Thinking... 42 tokens]  ← トークン受信後
claude
```

## 実践例

### 通常の使用時の表示改善

```bash
# Claude Codeを起動してプロンプトを入力
claude

# プロンプト入力後の処理中表示
# 修正前: "⠋ Thinking... 0 tokens" (即座に0トークンが表示)
# 修正後: "⠋ Thinking..." (トークン受信前はカウンター非表示)
#         "⠋ Thinking... 128 tokens" (受信が始まったら表示)
```

### 長い処理を伴うタスク

```bash
# 複雑なタスクを依頼した場合
claude -p "このリポジトリ全体のアーキテクチャを詳しく説明してください"

# スピナーの表示が改善され、より正確なフィードバックが得られる
# APIレスポンスの待機中は単純なスピナーアニメーションのみ表示
# トークンが流れ始めたらリアルタイムでカウントが更新
```

### 非インタラクティブモードでの確認

```bash
# パイプやスクリプトから使用する場合でも改善が適用される
echo "簡単な質問です" | claude

# 出力にスピナー表示は含まれないが、
# インタラクティブモードのUI改善が反映される
```

## 注意点

- この修正はv2.1.47以降で有効です
- この変更はUI表示のみに影響し、機能や動作には影響しません
- トークンカウンターは実際のAPIトークン消費量をリアルタイムで表示するためのものです
- 「0 tokens」の表示はユーザーに処理が始まっていないという誤解を与える可能性があったため修正されました
- スピナーの表示スタイルは `spinnerVerbs` 設定でカスタマイズできます

## 関連情報

- [Claude Code 公式ドキュメント](https://docs.anthropic.com/ja/docs/claude-code/overview)
- [Claude Code CHANGELOG](https://github.com/anthropics/claude-code/blob/main/CHANGELOG.md)
- [Issue #26105](https://github.com/anthropics/claude-code/issues/26105)
