---
title: "Web検索を使用したセッションで/forkがクラッシュする問題の修正"
date: 2026-02-19
tags: [bug-fix, fork, web-search, session, crash]
---

## 原文（日本語に翻訳）

Web検索を使用したセッションで `/fork` を使用した際にクラッシュしていた問題を修正しました — トランスクリプトのデシリアライズ時に検索結果に含まれるnullエントリが適切に処理されるようになりました（anthropics/claude-code#25811）

## 原文（英語）
Fixed crash when using `/fork` on sessions that used web search — null entries in search results from transcript deserialization are now handled gracefully (anthropics/claude-code#25811)

## 概要

Claude Codeの `/fork` コマンドを使用すると、現在のセッションをフォーク（分岐）して別のアプローチを試すことができます。しかし、そのセッションでWeb検索ツールが使用されていた場合、トランスクリプトのデシリアライズ時に検索結果データのnullエントリが原因でクラッシュが発生していました。この修正により、Web検索を含むセッションでも `/fork` コマンドが正常に動作するようになります。

## 基本的な使い方

Web検索を使用したセッションをフォークする。

```bash
# Web検索を含むセッションを開始
claude

> 最新のReact 19の新機能について検索して説明してください
# Claudeがweb_searchツールを使用して情報を取得

> その情報をもとにサンプルコードを書いてください
# 追加の回答が生成される

# このセッションをフォークして別のアプローチを試す
> /fork
# 修正後: 正常にフォークが実行される
# 修正前: Web検索を使用したセッションではクラッシュが発生していた
```

## 実践例

### ユースケース1: 調査結果をもとに複数の実装アプローチを比較

Web検索で情報を収集してから、異なる実装方法をフォークで並行検討する場合。

```bash
claude

# Web検索で情報収集
> Next.js 15のApp Routerのベストプラクティスを調べてください

# 調査結果をもとに基本設計を相談
> この情報をもとに、eコマースサイトのアーキテクチャを提案してください

# アプローチAを検討するためにフォーク
> /fork
# フォーク後のセッション（アプローチA）
> このアーキテクチャでサーバーコンポーネント中心の実装を提案してください

# 元のセッションに戻ってアプローチBを検討
# (別のターミナルで元のセッションを再開)
> クライアントコンポーネント中心の実装アプローチはどうでしょうか？
```

### ユースケース2: 外部API情報をもとにした複数の実装案の比較

APIドキュメントをWeb検索で調査後、実装方法を比較検討する場合。

```bash
claude

> Stripe APIの最新の支払いフロー実装について調べてください

> Payment Intents APIを使った実装を提案してください

# 別の支払い方法のアプローチを試すためにフォーク
> /fork
# フォーク後のセッション
> 代わりにPayment Links APIを使った実装ではどうなりますか？
```

### ユースケース3: フォーク後のセッション管理

フォークしたセッションを管理・確認する方法。

```bash
# フォーク後、新しいセッションが作成される
> /fork
# → 新しいセッションID: fork_session_abc123

# フォークされたセッションの一覧を確認
claude --resume
# 元のセッションとフォークされたセッションの両方が表示される

# セッションに名前を付けて管理する
> /rename "アプローチA: サーバーコンポーネント中心"
```

## 注意点

- `/fork` コマンドは現在のセッション状態を保ちつつ、新しいセッションブランチを作成します。
- フォーク後は元のセッションとフォークされたセッションは独立して進行します。
- Web検索ツールは利用可能なAPIプランや設定によって使用できない場合があります。
- フォークされたセッションも同様にWeb検索を使用できますが、検索履歴はリセットされます。
- 大きなセッション（多数のWeb検索を含む）のフォークは少し時間がかかる場合があります。

## 関連情報

- [Claude Code 公式ドキュメント](https://docs.anthropic.com/ja/docs/claude-code/overview)
- [Claude Code CHANGELOG](https://github.com/anthropics/claude-code/blob/main/CHANGELOG.md)
- [GitHub Issue #25811](https://github.com/anthropics/claude-code/issues/25811)
- [Web検索ツールについて](https://docs.anthropic.com/ja/docs/claude-code/overview)
- [セッション管理とフォーク](https://docs.anthropic.com/ja/docs/claude-code/overview)
