---
title: "mTLS とプロキシ接続性の修正"
date: 2026-01-29
tags: [bug-fix, security, enterprise, proxy, mtls]
---

## 原文（日本語訳）
企業プロキシの背後またはクライアント証明書を使用するユーザーのための mTLS とプロキシ接続性を修正しました

## 原文（英語）
Fixed mTLS and proxy connectivity for users behind corporate proxies or using client certificates

## 概要
企業ネットワーク環境でクライアント証明書（mTLS）を使用するユーザーや、企業プロキシの背後にいるユーザーが接続できなかった問題が修正されました。これにより、セキュアな企業環境でも Claude Code が正常に動作するようになります。

## 影響を受けていた環境

- 企業プロキシサーバーを経由してインターネットにアクセスする環境
- mTLS（相互 TLS）認証が必要な環境
- クライアント証明書による認証を使用する環境
- 自己署名証明書やカスタム CA を使用する企業ネットワーク

## 設定方法

### クライアント証明書の設定

環境変数で証明書を指定します。

```bash
export CLAUDE_CODE_CLIENT_CERT="/path/to/client-cert.pem"
export CLAUDE_CODE_CLIENT_KEY="/path/to/client-key.pem"
export CLAUDE_CODE_CLIENT_KEY_PASSPHRASE="your-passphrase"
```

### プロキシサーバーの設定

```bash
export HTTP_PROXY="http://proxy.company.com:8080"
export HTTPS_PROXY="http://proxy.company.com:8080"
export NO_PROXY="localhost,127.0.0.1,.company.local"
```

### カスタム CA 証明書の信頼

```bash
export NODE_EXTRA_CA_CERTS="/path/to/company-ca-bundle.pem"
```

## 実践例（簡潔版）

### 企業プロキシ経由の接続

```bash
# ~/.bashrc または ~/.zshrc に追加
export HTTP_PROXY="http://proxy.corp.com:3128"
export HTTPS_PROXY="http://proxy.corp.com:3128"

claude
```

### mTLS 認証が必要な環境

```bash
# クライアント証明書を指定
export CLAUDE_CODE_CLIENT_CERT="$HOME/.certs/client.crt"
export CLAUDE_CODE_CLIENT_KEY="$HOME/.certs/client.key"

claude
```

## 注意点

- **証明書のパス**: 証明書ファイルへの絶対パスを使用してください
- **権限設定**: 秘密鍵ファイルは適切な権限（600）で保護されていることを確認してください
- **パスフレーズ**: 秘密鍵が暗号化されている場合、`CLAUDE_CODE_CLIENT_KEY_PASSPHRASE` を設定します
- **プロキシ認証**: 認証が必要なプロキシの場合、URL に認証情報を含めます（例: `http://user:pass@proxy:8080`）
- **CA バンドル**: 企業の自己署名 CA を使用する場合、`NODE_EXTRA_CA_CERTS` で CA バンドルを指定します
- **接続テスト**: 設定後、`claude --help` などの簡単なコマンドで接続を確認してください
- **MCP サーバー**: MCP サーバーへの mTLS サポートは将来のアップデートで追加予定です

## 関連情報

- [Enterprise Network Configuration - Claude Code Docs](https://code.claude.com/docs/en/network-config)
- [Getting Claude Code to work in your corporate environment (Medium)](https://medium.com/@me_53022/getting-claude-code-to-work-in-your-corporate-environment-9ee34379214d)
- [Proxy and VPN Configuration](https://developertoolkit.ai/en/claude-code/advanced-techniques/proxy-configuration/)
- [Claude Code Environment Variables Reference](https://medium.com/@dan.avila7/claude-code-environment-variables-a-complete-reference-guide-41229ef18120)
