---
title: "キュー中のプロンプトでのEscキー動作を改善"
date: 2026-01-31
tags: ['バグ修正', 'UX', 'キーボード']
---

## 原文（日本語に翻訳）

キューに入れられたプロンプトがある状態でEscキーを押した際、実行中のタスクをキャンセルせず、プロンプトを入力欄に移動するだけになるよう修正しました

## 原文（英語）

Fixed Esc key with queued prompts to only move them to input without canceling the running task

## 概要

Claude Code v2.1.0で修正された、Escキーの動作に関する改善です。以前のバージョンでは、Claude Codeがタスクを実行中に次のプロンプトをキューに入れた状態でEscキーを押すと、実行中のタスクまでキャンセルされてしまう問題がありました。この修正により、Escキーはキューに入れられたプロンプトを入力欄に戻すだけで、実行中のタスクには影響を与えなくなりました。

## 修正前の問題

### 意図しないタスクのキャンセル

```bash
claude

# 1. 長時間かかるタスクを実行
> プロジェクト全体のリファクタリングを実行してください
# Claude Codeが作業中...

# 2. 次のタスクをキューに追加
> 次にテストを追加してください
# プロンプトがキューに入る

# 3. やっぱりキューのプロンプトを編集したい
# Esc キーを押す

# 問題: キューのプロンプトだけでなく、
# 実行中のリファクタリングタスクもキャンセルされてしまう
# → 進行中の作業が失われる
```

## 修正後の動作

### キューの管理のみ影響

```bash
claude

# 1. 長時間かかるタスクを実行
> プロジェクト全体のリファクタリングを実行してください
# Claude Codeが作業中...

# 2. 次のタスクをキューに追加
> 次にテストを追加してください
# プロンプトがキューに入る

# 3. キューのプロンプトを編集したい
# Esc キーを押す

# 修正後:
# ✓ キューのプロンプト "次にテストを追加してください" が入力欄に戻る
# ✓ 実行中のリファクタリングタスクは継続
# ✓ 入力欄でプロンプトを編集して再度キューに追加できる
```

## 実践例

### 複数タスクの効率的な管理

```bash
claude

# タスク1を実行中
> データベーススキーマを更新してください
# 実行中...

# タスク2をキュー
> APIエンドポイントを追加してください
# タスク3もキュー
> ドキュメントを更新してください

# タスク3の内容を変更したい
# Esc を押す
# ✓ タスク3のプロンプトが入力欄に戻る
# ✓ タスク1は実行継続、タスク2はキューに残る

# プロンプトを編集
> ドキュメントとサンプルコードを更新してください
# Enter で再度キューに追加
```

### キューの柔軟な調整

```bash
# 大規模なタスクを実行中
> 全モジュールのテストを実行
# 実行中...（5分かかる）

# 次のタスクを複数キュー
> レポートを生成
> 通知を送信

# "通知を送信" を削除したい
# Esc を押す
# ✓ "通知を送信" が入力欄に戻る
# ✓ テスト実行は継続

# プロンプトを破棄（何も入力せずEscまたはCtrl+C）
# または編集して再キュー
```

### 優先度の変更

```bash
# タスク実行中
> ビルドを実行
# 実行中...

# 後続タスクをキュー
> デプロイを実行

# やっぱり先にテストを追加したい
# Esc を押す
# ✓ "デプロイを実行" が入力欄に戻る
# ✓ ビルドは継続

> テストを実行
# 新しいプロンプトをキュー

> デプロイを実行
# 元のプロンプトを再度キュー

# 結果: ビルド → テスト → デプロイ の順序になる
```

## 注意点

- この修正は Claude Code v2.1.0（2026年1月7日リリース）で実装されました
- **v2.1.0未満のバージョンではこの問題が発生します**
- Escキーの動作:
  - **キューにプロンプトがある場合**: 最後のキューをプロンプトを入力欄に戻す（実行中のタスクは継続）
  - **キューにプロンプトがない場合**: 実行中のタスクを中断
- 関連するキーボード操作:
  - **Esc Esc（2回）**: リワインド操作（以前の状態に戻る）
  - **Ctrl+C**: 現在の操作をキャンセル
- 複数のプロンプトがキューにある場合、Escキーは最後に追加されたプロンプトから順に戻します
- キューからプロンプトを入力欄に戻した後、何も入力せずにEscやCtrl+Cを押すとプロンプトを破棄できます
- この改善により、タスクの実行中でも次のタスクの内容を柔軟に調整できるようになりました

## 関連情報

- [Interactive mode - Claude Code Docs](https://code.claude.com/docs/en/interactive-mode)
- [GitHub Issue: ESC key behavior](https://github.com/anthropics/claude-code/issues/6643)
- [Feature Request: Allow remapping ESC keybinding](https://github.com/anthropics/claude-code/issues/16176)
