---
title: "サブエージェントを使った長時間セッションのメモリ使用量を改善"
date: 2026-02-28
tags: [improvement, memory, subagents, compaction, performance]
---

# サブエージェントを使った長時間セッションのメモリ使用量を改善

## 原文（日本語に翻訳）

コンテキスト圧縮中に重いプログレスメッセージのペイロードを削除することで、サブエージェントを使った長時間セッションのメモリ使用量を改善しました。

## 原文（英語）

Improved memory usage in long sessions with subagents by stripping heavy progress message payloads during context compaction

## 概要

Claude Code v2.1.63から、サブエージェント（Agent ツールで起動される並列タスク）を使用した長時間セッションでのメモリ使用量が改善されました。コンテキスト圧縮（compaction）の際に、重いプログレスメッセージのペイロードを削除することで、メモリ効率が向上します。複数のサブエージェントを並行して実行するような複雑なタスクでの恩恵が大きいです。

## 基本的な使い方

この改善はバックグラウンドで自動的に適用されます。ユーザー側での操作は不要です。

## 実践例

### 影響を受けるシナリオ

```
# 複数サブエージェントを使う複雑なタスク例
ユーザー: 「大規模なコードベースをリファクタリングして」

Claude:
- サブエージェント1: ファイルAを解析・修正（多数のプログレスメッセージ）
- サブエージェント2: ファイルBを解析・修正（多数のプログレスメッセージ）
- サブエージェント3: テストを実行（多数のプログレスメッセージ）

コンテキスト圧縮時:
修正前：プログレスメッセージの重いペイロードを保持
修正後：不要なペイロードを削除 → メモリ使用量削減
```

### 改善の効果が大きいケース

- 多数のファイルを並行して処理するタスク
- 長時間実行されるサブエージェントを複数使用するワークフロー
- 大規模なリポジトリのリファクタリングや分析

## 注意点

- v2.1.63にアップデートすることで自動的に適用されます
- プログレスメッセージのペイロードが削除されるのは圧縮後のみです。現在進行中のタスクには影響しません
- 会話の内容自体は保持されます。削除されるのは内部的な進捗データのみです

## 関連情報

- [Claude Code サブエージェント（Agent ツール）](https://docs.anthropic.com/ja/docs/claude-code/agents)
- [Claude Code コンテキスト管理](https://docs.anthropic.com/ja/docs/claude-code/context)
