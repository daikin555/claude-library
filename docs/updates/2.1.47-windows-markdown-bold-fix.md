---
title: "Windowsでのマークダウン太字・色付きテキストのズレ修正"
date: 2026-02-19
tags: [bug-fix, windows, markdown, terminal]
---

## 原文（日本語に翻訳）

`\r\n` 改行コードが原因で、マークダウン出力の太字および色付きテキストがWindows上で誤った文字にシフトしてしまうバグを修正しました。

## 原文（英語）
Fixed a bug where bold and colored text in markdown output could shift to the wrong characters on Windows due to `\r\n` line endings.

## 概要

Windowsの改行コード`\r\n`（CR+LF）がマークダウンのレンダリング処理に混入することで、太字（`**text**`）や色付きテキストの表示位置が正しい文字からズレてしまう問題がありました。この修正により、Windows環境でもマークダウンの書式が正確に適用されるようになりました。文字化けや意図しない装飾ズレが解消されます。

## 基本的な使い方

```bash
# Windows環境でのClaude Code マークダウン表示
# 修正前: 太字や色付きテキストが別の文字に適用されてしまっていた
# 修正後: 正確な文字に太字・色付きが適用される

# 例: "**重要**なポイント" の表示
# 修正前: 文字がズレて表示される
# 修正後: 「重要」が正しく太字で表示される
```

## 実践例

### ユースケース1: レスポンスの太字表示確認

```powershell
# Claude Codeのレスポンスに含まれる太字テキストの確認
# Windows PowerShellまたはコマンドプロンプトで実行

claude "このプロジェクトの重要なポイントを教えてください"

# 修正後の出力例:
# **重要なポイント1**: セキュリティの考慮
# **重要なポイント2**: パフォーマンスの最適化
# ← 太字が正しい文字に適用される
```

### ユースケース2: エラーメッセージの色付き表示

```powershell
# エラーや警告の色付き表示
# 修正前: 赤いエラーテキストが隣の文字に適用される問題があった
# 修正後: エラーメッセージが正確な位置に赤で表示される

# Claude Codeのデバッグ出力でも正確な色付けが機能する
claude --debug "エラーのあるコードをチェックしてください"
```

### ユースケース3: コードブロックとインラインコードの表示

```powershell
# マークダウンのインラインコード表示
# `code` 形式のテキストが正確に色付き表示される

# 修正後は以下のようなレスポンスが正確に表示される:
# `npm install` を実行してください
# `package.json` ファイルを確認してください
# ← バッククォートで囲まれた部分が正確にハイライトされる
```

## 注意点

- この修正はWindowsのネイティブ環境（コマンドプロンプト、PowerShell）に特有の問題です
- Windows Subsystem for Linux (WSL) 環境では`\n`が使用されるため、この問題は発生しませんでした
- `\r\n`の`\r`（キャリッジリターン）がANSIエスケープシーケンスの解析を乱すことが原因でした
- バージョン2.1.47以降で修正が適用されます

## 関連情報

- [Claude Code 公式ドキュメント](https://docs.anthropic.com/ja/docs/claude-code/overview)
- [Claude Code CHANGELOG](https://github.com/anthropics/claude-code/blob/main/CHANGELOG.md)
- [Windows ターミナルの設定](https://docs.anthropic.com/ja/docs/claude-code/setup)
