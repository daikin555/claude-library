---
title: "エージェント進捗インジケーターのツール使用数が膨れ上がる問題を修正"
date: 2026-02-19
tags: [bug-fix, agents, ui, progress]
---

## 原文（日本語に翻訳）

エージェントの進捗インジケーターが膨れ上がったツール使用数を表示する問題を修正しました（anthropics/claude-code#26023）。

## 原文（英語）
Fixed agent progress indicator showing inflated tool use count (anthropics/claude-code#26023)

## 概要

エージェントが動作中に表示される進捗インジケーターのツール使用カウントが、実際の使用数より大幅に大きな数値を表示するバグが修正されました。例えば実際には5回しかツールを使っていないのに「25回使用済み」のように表示されることがありました。修正後は正確なツール使用数が表示されます。

## 基本的な使い方

```bash
# エージェントを起動してタスクを実行
claude "src/ ディレクトリ以下のすべてのファイルをチェックして、
TypeScriptの型エラーを修正してください"

# 作業中の進捗表示（修正前）:
# Agent working... (tools used: 47)  ← 実際は10回程度なのに誤った数値

# 作業中の進捗表示（修正後）:
# Agent working... (tools used: 10)  ← 正確な数値
```

## 実践例

### ユースケース1: 大規模リファクタリングの進捗監視

エージェントに大規模なリファクタリングを依頼して進捗を確認する場合。

```bash
# 大規模リファクタリングの依頼
claude "プロジェクト全体のimportをES modulesに変換して"

# 進捗表示（修正後）:
# Agent working...
# - Reading: src/index.ts (tool 1/?)
# - Reading: src/utils.ts (tool 2/?)
# - Editing: src/index.ts (tool 3/?)
# - Editing: src/utils.ts (tool 4/?)
# ...
# Agent completed (12 tools used)  ← 正確なカウント

# 修正前は "120 tools used" のような誇張された数値が表示されることがあった
```

### ユースケース2: バックグラウンドエージェントの監視

バックグラウンドで動作するエージェントの効率を評価する場合。

```bash
# バックグラウンドエージェントを起動
claude --background "テストスイート全体を実行して結果をまとめて"

# 別のターミナルで進捗確認
claude --status

# 修正後の出力:
# Background agents:
# [1] テストスイート実行
#     Status: running
#     Tools used: 8    ← 正確な数値（修正前は80などと表示されることがあった）
#     Duration: 2m 34s
```

### ユースケース3: ツール使用効率の最適化

エージェントのツール使用数を基にプロンプトを最適化する場合。

```bash
# タスクの効率を測定
claude "package.jsonの依存関係を分析して古いパッケージを特定して"

# 修正後の正確な進捗:
# Analyzing dependencies...
# Tools used: 3 (read package.json, check npm registry x2)
# Found 5 outdated packages

# 正確なツール使用数を基に、プロンプトを改善できる
# 例: ツール数が多すぎる場合はより具体的な指示に変更
```

## 注意点

- この修正はUIの表示の問題であり、エージェントの実際の動作や結果には影響していませんでした
- ツール使用数は課金や制限に直接関係することがあるため、正確な数値の表示は重要です
- 修正前に記録したエージェントの効率データはツール数が誇張されている可能性があります。v2.1.47以降で再測定することを推奨します
- 進捗インジケーターはリアルタイムで更新されます。最終的な使用数はタスク完了後に確認できます

## 関連情報

- [Claude Code 公式ドキュメント](https://docs.anthropic.com/ja/docs/claude-code/overview)
- [CHANGELOG.md](https://github.com/anthropics/claude-code/blob/main/CHANGELOG.md)
- [GitHub Issue #26023](https://github.com/anthropics/claude-code/issues/26023)
- [Claude Code エージェント機能ガイド](https://docs.anthropic.com/ja/docs/claude-code/sub-agents)
