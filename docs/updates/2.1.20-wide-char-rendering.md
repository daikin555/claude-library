---
title: "ワイド文字（絵文字・CJK）レンダリングの修正"
date: 2026-01-27
tags: [bugfix, rendering, emoji, cjk, unicode]
---

## 原文（日本語訳）
ワイド文字（絵文字、CJK）が狭い文字に置き換えられた際に、後続のカラムがクリアされないレンダリングアーティファクトの問題が修正されました

## 原文（英語）
Fixed wide character (emoji, CJK) rendering artifacts where trailing columns were not cleared when replaced by narrower characters

## 概要
絵文字や CJK 文字（中国語、日本語、韓国語）などのワイド文字が、狭い文字に置き換えられた際に発生していた表示の乱れが修正されました。ターミナルでの日本語や絵文字の表示がより正確になります。

## 問題の背景

### 修正前の問題
- ワイド文字（2カラム幅）が通常文字（1カラム幅）に置き換えられると、後続のカラムが適切にクリアされず、ゴミ文字が残った
- 特に日本語、中国語、韓国語の文字や絵文字で顕著だった
- 表示が崩れ、読みにくくなることがあった

### 修正後
- 文字置き換え時に後続カラムが正しくクリアされる
- 表示が常にクリーンで読みやすい
- CJK 文字と絵文字が正確に表示される

## 基本的な使い方

特別な設定は不要です。通常通り Claude Code を使用するだけで、改善された表示が適用されます。

```bash
claude
> 日本語のコメントを含むコードを生成して
# ✅ 日本語が正しく表示される
```

## 実践例

### 日本語コメントを含むコード生成

```bash
claude
> React コンポーネントを作成して、日本語コメント付きで

# 修正前の問題:
"""
// ユーザー情報を取得hB  # ← "hB" のようなゴミ文字が表示
"""

# 修正後:
"""
// ユーザー情報を取得
"""
```

### 絵文字を含む出力

```bash
claude
> タスクリストを絵文字付きで表示して

# 修正前:
"""
✅ 完了hB
⏳ 進行中hB
"""

# 修正後:
"""
✅ 完了
⏳ 進行中
"""
```

### CJK 文字を含むファイル編集

```bash
claude
> README.md に日本語の説明を追加して

# ファイル内容:
"""
# プロジェクト概要

このプロジェクトは...
"""
# ✅ 正しく表示・編集される
```

### マークダウンテーブルの表示

```bash
claude
> 機能一覧を日本語のテーブルで作成して

# 修正前（表示崩れ）:
"""
| 機能名hB | 説明hB     |
| ----hB | --------hB |
"""

# 修正後（正しい表示）:
"""
| 機能名   | 説明       |
| -------- | ---------- |
| 認証     | JWT認証    |
| データ   | CRUD操作   |
"""
```

### ログ出力での日本語

```bash
claude
> エラーハンドリングを追加して、エラーメッセージは日本語で

# コード生成:
"""
try {
  // 処理...
} catch (error) {
  console.error('エラーが発生しました:', error);
}
"""
# ✅ エラーメッセージが正しく表示
```

## ターミナル表示の改善例

### コード差分表示

```bash
claude
> 日本語変数名を英語に変更して

# Diff 表示:
"""
- const ユーザー名 = 'test';
+ const userName = 'test';
"""
# ✅ 変更前後が正しく表示される
```

### プログレス表示

```bash
claude
> 大量のファイルを処理して

# プログレス:
"""
処理中... ⏳
完了しました ✅
"""
# ✅ 絵文字が正しく表示される
```

### エラーメッセージ

```bash
# エラー発生時:
"""
❌ エラー: ファイルが見つかりません
"""
# ✅ 絵文字とメッセージが正しく表示
```

## 影響を受けるワイド文字

### 絵文字
- ✅ ❌ ⏳ 🔴 🟢 🟡
- 😀 😃 😄 😁 😆
- 🚀 🔥 💡 📝

### CJK 文字
- 日本語: ひらがな、カタカナ、漢字
- 中国語: 简体字、繁體字
- 韓国語: 한글

### 全角記号
- 全角スペース
- 全角括弧（）
- 全角数字０１２３

## 注意点

- **ターミナルのサポート**: 一部の古いターミナルでは、ワイド文字自体のサポートが不完全な場合があります
- **フォント**: CJK 文字を正しく表示するには、適切なフォントが必要です
- **ロケール設定**: システムのロケールが UTF-8 に設定されていることを確認してください

## 推奨ターミナル設定

### macOS
```bash
# iTerm2 または標準ターミナル
# フォント: SF Mono, Menlo, または Noto Sans CJK
```

### Linux
```bash
# ロケール確認
locale

# UTF-8 設定
export LANG=ja_JP.UTF-8
export LC_ALL=ja_JP.UTF-8
```

### Windows
```bash
# Windows Terminal 推奨
# フォント: MS Gothic, Yu Gothic, または Noto Sans CJK
```

## トラブルシューティング

### 文字が正しく表示されない場合

```bash
# 1. ロケール確認
echo $LANG
# ja_JP.UTF-8 または en_US.UTF-8 であることを確認

# 2. ターミナルの文字エンコーディング確認
# ターミナル設定で UTF-8 を選択

# 3. フォント確認
# CJK 対応フォントを使用
```

### 文字幅の問題

```bash
# East Asian Width が Ambiguous な文字の扱い
# ターミナル設定で「East Asian Ambiguous を全角として扱う」を有効化
```

## 関連する修正

### Thai/Lao スペーシング母音の修正（v2.1.32）

```bash
# タイ語・ラオス語の母音（สระ า, ำ）も正しく表示されるようになった
```

### IME サポート（v2.0.68）

```bash
# 日本語入力（IME）の変換候補表示位置も改善された
```

## 関連情報

- [Claude Code Changelog - Wide Character Fixes](https://claudefa.st/blog/guide/changelog)
- [CJK Character Display Issues on GitHub](https://github.com/anthropics/claude-code/issues/13438)
- [UTF-8 Encoding Issues Fix](https://gist.github.com/killerapp/6c53b69639ceef5139b276995879a6ac)
