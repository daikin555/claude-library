---
title: "画像サイズ制限エラー時に/compactコマンドを提案する機能の追加"
date: 2026-02-13
tags: [bugfix, image, compact, error-handling]
---

## 原文（日本語）
画像サイズ制限エラーが発生した際に、`/compact`コマンドの使用を提案するように修正しました。

## 原文（英語）
Fixed image dimension limit errors to suggest /compact

## 概要
Claude Code v2.1.42では、画像のピクセル数制限エラーが発生した際に、単なるエラー表示だけでなく`/compact`コマンドの使用を提案するようになりました。これにより、ユーザーは会話履歴を圧縮して画像を再送信できることを理解し、スムーズに作業を継続できます。

## 問題の背景

### 画像サイズ制限
Claude Codeでは、複数の画像（20枚以上）を送信する場合、各画像の解像度が2000×2000ピクセルに制限されます。この制限を超える画像を含むリクエストはエラーとなり、以前はエラーメッセージのみが表示されていました。

### 従来の問題
エラーが発生すると、その後のコマンドが受け付けられなくなり、ユーザーは対処方法がわからないまま作業が停止してしまうことがありました。

## 基本的な使い方

### エラー発生時の対処
画像サイズ制限エラーが表示された場合、提案に従って`/compact`コマンドを実行します。

```bash
# エラーメッセージ例
❌ Image dimension limit exceeded (2000×2000 pixels for multi-image requests)
💡 Try using /compact to compress conversation history

# 提案されたコマンドを実行
> /compact
```

### /compactコマンドの効果
`/compact`コマンドは、現在の会話履歴を要約し、新しいセッションとして再開します。これにより、コンテキストをリセットして画像を再送信できます。

```bash
# 会話履歴を圧縮
> /compact

# 圧縮後、画像を再度添付して送信
> 📎 (画像を添付)
"この画像を解析してください"
```

## 実践例

### 複数の高解像度画像を扱う場合
デザインレビューやUIの比較など、複数の高解像度画像を扱う際の対処法です。

```bash
# 20枚以上の画像を扱うプロジェクト
> 📎 (22枚の高解像度スクリーンショットを添付)
"これらのUIデザインを比較してください"

# エラー発生
❌ Image dimension limit exceeded
💡 Try using /compact to compress conversation history

# 会話を圧縮
> /compact

# 画像をリサイズまたは分割して再送信
# 方法1: 画像を2000×2000以下にリサイズしてから送信
# 方法2: 画像を複数のメッセージに分けて送信
```

### 長時間の会話で画像を追加する場合
長時間の開発セッション中に画像を追加する際、コンテキストが大きくなりすぎた場合の対処法です。

```bash
# 長時間のコーディングセッション後
> 📎 (エラー画面のスクリーンショット - 2500×2500ピクセル)
"このエラーを解決してください"

# エラー発生
❌ Image dimension limit exceeded
💡 Try using /compact to compress conversation history

# 会話を圧縮して再送信
> /compact
> 📎 (同じ画像をリサイズしたもの - 1920×1080ピクセル)
"このエラーを解決してください"
```

### デザイン作業での画像比較
複数のデザイン案を比較する際、画像サイズに注意しながら効率的に作業します。

```bash
# デザイン案A〜Eを比較（各2400×2400ピクセル）
> 📎 (5枚の画像を添付)
"これらのデザイン案の中で最適なものを選んでください"

# エラーが発生した場合
> /compact

# 画像を最適なサイズに調整してから再送信
# 推奨: 1920×1080または1000×1000ピクセル程度
```

## この修正の利点

### ユーザー体験の向上
- エラー時に具体的な解決策が提示される
- `/compact`コマンドの存在を知らないユーザーも適切に対処できる
- 作業の中断を最小限に抑えられる

### 明確なエラーハンドリング
- 問題の原因（画像サイズ制限）が明確
- 次のアクションが明示的に提案される
- ユーザーが自己解決しやすい

## 注意点
- `/compact`実行後は、会話履歴が要約されるため、詳細な文脈は失われます
- 重要な情報は`/compact`実行前にメモしておくことを推奨します
- 画像サイズの制限（2000×2000ピクセル）は、複数画像（20枚以上）の場合のみ適用されます
- 単一画像の場合は、より大きなサイズ（最大30MB、より高い解像度）が許容されます

## 画像サイズのベストプラクティス
- 複数画像を送信する場合: 各画像を2000×2000ピクセル以下に保つ
- 最適な解像度: 詳細な視覚タスクには1000×1000ピクセル以上を推奨
- ファイルサイズ: 30MB以下に抑える

## 関連情報
- [How Claude Code works - Claude Code Docs](https://code.claude.com/docs/en/how-claude-code-works)
- [Context Window Management - The Compact Command](https://deepwiki.com/FlorianBruniaux/claude-code-ultimate-guide/3.2-the-compact-command)
- [Claude Code supported image upload types | ClaudeLog](https://claudelog.com/faqs/claude-code-supported-image-upload-types/)
- [Image dimension error blocks all subsequent commands · Issue #2752](https://github.com/anthropics/claude-code/issues/2752)
