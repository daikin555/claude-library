#!/bin/bash

# バージョンと記事数のマッピング
declare -A VERSION_COUNTS=(
    ["2.1.0"]=109
    ["2.1.2"]=22
    ["2.1.3"]=13
    ["2.1.4"]=2
    ["2.1.5"]=1
    ["2.1.6"]=25
    ["2.1.7"]=15
    ["2.1.9"]=9
    ["2.1.10"]=7
    ["2.1.11"]=1
    ["2.1.12"]=1
    ["2.1.14"]=16
    ["2.1.15"]=4
    ["2.1.16"]=7
    ["2.1.17"]=1
    ["2.1.18"]=1
    ["2.1.19"]=14
    ["2.1.20"]=28
    ["2.1.21"]=10
    ["2.1.22"]=1
    ["2.1.23"]=11
    ["2.1.25"]=1
    ["2.1.27"]=10
)

declare -A RELEASE_DATES=(
    ["2.1.0"]="2026-01-07"
    ["2.1.2"]="2026-01-09"
    ["2.1.3"]="2026-01-09"
    ["2.1.4"]="2026-01-11"
    ["2.1.5"]="2026-01-12"
    ["2.1.6"]="2026-01-13"
    ["2.1.7"]="2026-01-14"
    ["2.1.9"]="2026-01-16"
    ["2.1.10"]="2026-01-16"
    ["2.1.11"]="2026-01-17"
    ["2.1.12"]="2026-01-17"
    ["2.1.14"]="2026-01-20"
    ["2.1.15"]="2026-01-21"
    ["2.1.16"]="2026-01-22"
    ["2.1.17"]="2026-01-22"
    ["2.1.18"]="2026-01-23"
    ["2.1.19"]="2026-01-23"
    ["2.1.20"]="2026-01-27"
    ["2.1.21"]="2026-01-28"
    ["2.1.22"]="2026-01-28"
    ["2.1.23"]="2026-01-29"
    ["2.1.25"]="2026-01-29"
    ["2.1.27"]="2026-01-30"
)

# バージョンを新しい順にソート
VERSIONS=(2.1.27 2.1.25 2.1.23 2.1.22 2.1.21 2.1.20 2.1.19 2.1.18 2.1.17 2.1.16 2.1.15 2.1.14 2.1.12 2.1.11 2.1.10 2.1.9 2.1.7 2.1.6 2.1.5 2.1.4 2.1.3 2.1.2 2.1.0)

for version in "${VERSIONS[@]}"; do
    count="${VERSION_COUNTS[$version]}"
    release_date="${RELEASE_DATES[$version]}"

    # issueのタイトル
    title="docs: v${version}の記事詳細化（${count}記事）"

    # issueの本文を作成
    body=$(cat <<EOF
## 概要

v${version}（リリース日: ${release_date}）の${count}記事について、以下の作業を実施します。

## 対象記事

\`docs/updates/2026-01-31-v${version//./-}-*.md\` （${count}ファイル）

## 作業内容

### 1. 日本語訳の改善
- [ ] 現在の機械的な翻訳を自然な日本語に修正
- [ ] タイトルを分かりやすく調整

### 2. Web検索による調査
- [ ] 公式ドキュメント（https://code.claude.com/docs/）を検索
- [ ] 関連するブログ記事やリリースノートを調査
- [ ] 実装例やベストプラクティスを収集

### 3. 記事内容の充実
- [ ] 概要セクションの詳細化（2-3文で機能を説明）
- [ ] 基本的な使い方の追加（具体的なコマンド例）
- [ ] 実践例の追加（ユースケース別）
- [ ] 注意点・Tipsの追加
- [ ] 関連情報リンクの追加

### 4. タグの最適化
- [ ] 適切なタグを設定（新機能、バグ修正、改善など）
- [ ] プラットフォーム固有タグ（Windows, VSCode, MCPなど）

## 優先度

- **高**: 新機能（Added）エントリ
- **中**: 重要な修正（Fixed）エントリ
- **低**: UI改善（Changed, Improved）エントリ

## 進捗

- [ ] 調査完了
- [ ] 記事更新完了
- [ ] レビュー完了

## 参考

- [Changelog v${version}](https://github.com/anthropics/claude-code/releases/tag/v${version})
- [公式ドキュメント](https://code.claude.com/docs/)
EOF
)

    # issueを作成
    echo "Creating issue for v${version}..."
    gh issue create \
        --title "$title" \
        --body "$body" \
        --label "documentation" \
        --label "enhancement"

    # レート制限回避のため少し待機
    sleep 1
done

echo ""
echo "Created issues for all versions!"
